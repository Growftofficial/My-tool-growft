<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Vijay Menu - Growft Tech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 pb-24"> 
    <div class="bg-orange-600 text-white p-6 text-center shadow-lg">
        <h1 class="text-3xl font-bold italic">Hotel Vijay</h1>
        <p class="text-sm opacity-80 mt-1">Swaad Jo Yaad Rahe | Powered by Growft</p>
    </div>

    <div class="max-w-md mx-auto p-4">
        <div class="bg-white p-4 rounded-xl shadow-sm mb-6 border border-gray-200">
            <h3 class="font-bold text-gray-700 mb-3 text-center border-b pb-2">Table Details</h3>
            <input id="name" type="text" placeholder="Aapka Naam" class="w-full border p-3 rounded-lg mb-2 outline-none focus:ring-2 focus:ring-orange-500">
            <input id="table" type="number" placeholder="Table Number" class="w-full border p-3 rounded-lg outline-none focus:ring-2 focus:ring-orange-500">
        </div>

        <h2 class="text-xl font-bold mb-4 text-gray-800 text-center">Our Special Menu</h2>
        <div id="menu-list" class="space-y-4"></div>
    </div>

    <div id="cart-bar" class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t shadow-2xl hidden">
        <div class="max-w-md mx-auto flex justify-between items-center mb-3 px-2">
            <span class="font-bold text-gray-600">Items: <span id="item-count" class="text-orange-600">0</span></span>
            <span class="font-bold text-xl text-gray-800">Total: ₹<span id="total-price">0</span></span>
        </div>
        <button onclick="sendOrder()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-green-700 shadow-lg flex justify-center items-center gap-2">
            Order on WhatsApp
        </button>
    </div>

    <script>
        // Supabase Setup
        const SUPABASE_URL = 'https://ghfwvbpyqkrzysetgrnao.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdoZnd2YnB5cWtyenNldGdybmFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMDk3MjQsImV4cCI6MjA4NTg4NTcyNH0.ZAgScUNHVEm7LNMN268Ws7z7m_oTCxIv8yQ0bYlJXzQ';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const menuItems = [
            { id: 1, name: "Paneer Masala", price: 250 },
            { id: 2, name: "Dal Tadka", price: 180 },
            { id: 3, name: "Butter Naan", price: 40 },
            { id: 4, name: "Veg Pulao", price: 150 },
            { id: 5, name: "Cold Drink", price: 30 }
        ];

        let cart = [];

        function renderMenu() {
            try {
                const container = document.getElementById('menu-list');
                container.innerHTML = ''; 
                menuItems.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "bg-white p-4 rounded-xl flex justify-between items-center shadow-sm border border-gray-100";
                    div.innerHTML = `
                        <div>
                            <p class="font-bold text-gray-800">${item.name}</p>
                            <p class="text-orange-600 font-semibold">₹${item.price}</p>
                        </div>
                        <button onclick="addToCart(${item.id})" class="bg-orange-50 text-orange-600 px-6 py-2 rounded-full font-bold hover:bg-orange-600 hover:text-white transition-colors">
                            + Add
                        </button>
                    `;
                    container.appendChild(div);
                });
            } catch (e) { console.error("Menu Render Error:", e); }
        }

        function addToCart(id) {
            const selectedItem = menuItems.find(item => item.id === id);
            cart.push(selectedItem);
            updateCartUI();
        }

        function updateCartUI() {
            const cartBar = document.getElementById('cart-bar');
            if (cart.length > 0) {
                cartBar.classList.remove('hidden');
                document.getElementById('item-count').innerText = cart.length;
                const total = cart.reduce((sum, item) => sum + item.price, 0);
                document.getElementById('total-price').innerText = total;
            }
        }

        async function sendOrder() {
            const nameVal = document.getElementById('name').value;
            const tableVal = document.getElementById('table').value;

            if (!nameVal || !tableVal) {
                alert("Please enter Name and Table Number!");
                return;
            }

            const totalAmt = cart.reduce((sum, item) => sum + item.price, 0);
            const itemsStr = cart.map(i => i.name).join(', ');
            const invID = "VJ-" + Math.floor(Math.random() * 9000 + 1000);

            const message = "*Hotel Vijay - New Order*\n------------------------\n*Inv:* #" + invID + "\n*Name:* " + nameVal + "\n*Table:* " + tableVal + "\n*Items:* " + itemsStr + "\n*Total Bill:* ₹" + totalAmt + "\n------------------------";
            const waUrl = "https://wa.me/917498988626?text=" + encodeURIComponent(message);

            // Database Save and Redirect Logic
            try {
                await supabaseClient.from('orders').insert([{
                    invoice_no: invID,
                    customer_name: nameVal,
                    table_no: parseInt(tableVal),
                    items: itemsStr,
                    total_amount: totalAmt
                }]);
                window.location.href = waUrl;
            } catch (err) {
                console.warn("Database save failed, redirecting to WhatsApp anyway...");
                window.location.href = waUrl;
            }
        }

        // Program Start
        renderMenu();
    </script>
</body>
</html>