<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Vijay - Smart Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .category-pill { transition: all 0.3s; white-space: nowrap; }
        .category-pill.active { background: #ea580c; color: white; border-color: #ea580c; }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .track-btn-animate { animation: slideUp 0.5s ease-out forwards; }
        .bounce-food { animation: bounceFood 1s infinite alternate; }
        @keyframes bounceFood { 0% { transform: translateY(0) scale(1.1); } 100% { transform: translateY(-30px) scale(0.9); } }
        .shadow-pulse { animation: shadowPulse 1s infinite alternate; }
        @keyframes shadowPulse { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(0.5); opacity: 0.1; } }
    </style>
</head>
<body class="bg-gray-50 pb-40 font-sans text-slate-900">

    <div id="menu-loader" class="fixed inset-0 bg-gray-50 z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="relative w-32 h-32 mb-4 flex flex-col items-center">
            <div class="text-7xl bounce-food z-10">üçî</div>
            <div class="w-16 h-3 bg-gray-300 rounded-[100%] absolute bottom-0 shadow-pulse"></div>
        </div>
        <h2 class="text-2xl font-black text-slate-800 italic uppercase tracking-widest mt-4">Kitchen is Warming Up!</h2>
        <p class="text-[10px] font-bold text-orange-500 uppercase tracking-widest mt-2 animate-pulse">Fetching Live Menu...</p>
    </div>

    <div class="bg-orange-600 text-white p-6 pb-12 rounded-b-[3rem] shadow-xl sticky top-0 z-50">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-3xl font-black italic tracking-tighter uppercase">Hotel Vijay</h1>
                <p class="text-[10px] font-bold opacity-80 uppercase tracking-widest">Growft Digital Menu</p>
            </div>
            <div class="bg-white/20 p-2 rounded-2xl backdrop-blur-md text-xs font-bold border border-white/30">
                Table: <span id="display-table">--</span>
            </div>
        </div>
        <div class="flex gap-2 overflow-x-auto no-scrollbar py-2" id="category-tabs"></div>
    </div>

    <div class="max-w-md mx-auto -mt-6 p-4">
        <div class="bg-white p-6 rounded-[2rem] shadow-sm mb-6 border border-gray-100 flex gap-4">
            <input id="name" type="text" placeholder="Aapka Naam" class="w-full bg-gray-50 p-4 rounded-2xl font-bold outline-none border-none text-sm focus:ring-2 focus:ring-orange-500">
            <input id="table" type="number" placeholder="Table" class="w-24 bg-gray-50 p-4 rounded-2xl font-bold outline-none border-none text-sm focus:ring-2 focus:ring-orange-500" oninput="document.getElementById('display-table').innerText = this.value">
        </div>
        <div id="menu-container" class="space-y-8"></div>
    </div>

    <div id="cart-bar" class="fixed bottom-0 left-0 right-0 p-5 bg-white/80 backdrop-blur-xl border-t border-gray-100 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] hidden z-50">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div>
                <p class="text-[10px] text-gray-400 font-black uppercase tracking-widest">Total Bill</p>
                <span class="text-3xl font-black text-orange-600">‚Çπ<span id="total-price">0</span></span>
            </div>
            <button onclick="placeOrder()" id="orderBtn" class="bg-slate-900 text-white px-10 py-4 rounded-[1.5rem] font-black active:scale-95 transition-all shadow-lg hover:bg-orange-600">
                PLACE ORDER
            </button>
        </div>
    </div>

    <div id="track-float-btn" class="fixed bottom-28 right-5 hidden z-[60] track-btn-animate">
        <button onclick="goToTracking()" class="bg-slate-900 text-white p-4 rounded-2xl shadow-2xl flex items-center gap-3 animate-bounce border-2 border-orange-500">
            <span class="text-2xl">üöö</span>
            <div class="text-left">
                <p class="text-[8px] font-black text-orange-500 uppercase leading-none">Order Live!</p>
                <p class="text-[10px] font-black uppercase">Track Status</p>
            </div>
        </button>
    </div>

    <script>
        // ==========================================
        // YAHAN APNA MASTER SCRIPT URL DALNA HAI
        // ==========================================
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFZXiQ9c1CPbJ6Js0o6HtIt4mEIRigzAI6CxgXKLId5fOy3VCoLBZC_F4DAspf1h4EsA/exec";
        
        let menuData = [];
        let cart = {};
        let currentOrderID = localStorage.getItem('activeVijayOrder') || "";

        window.onload = () => {
            if(currentOrderID) { document.getElementById('track-float-btn').classList.remove('hidden'); }
        };

        async function fetchMenu() {
            try {
                const res = await fetch(SCRIPT_URL + "?get=menu");
                menuData = await res.json();
                renderUI();
                setTimeout(() => {
                    document.getElementById('menu-loader').style.opacity = '0';
                    setTimeout(() => document.getElementById('menu-loader').classList.add('hidden'), 500);
                }, 500);
            } catch (e) {
                document.getElementById('menu-loader').innerHTML = `
                    <div class="text-center">
                        <div class="text-5xl mb-4">üò¢</div>
                        <h2 class="text-xl font-black text-red-600">Menu Load Nahi Hua!</h2>
                        <p class="text-sm text-slate-500 mt-2">Internet connection check karein.</p>
                        <button onclick="location.reload()" class="mt-6 bg-orange-600 text-white px-6 py-2 rounded-xl font-bold">Refresh Page</button>
                    </div>`;
            }
        }

        function renderUI() {
            const categories = [...new Set(menuData.map(item => item.category))];
            const tabs = document.getElementById('category-tabs');
            tabs.innerHTML = categories.map(cat => `
                <button onclick="scrollToCategory('${cat}')" class="category-pill px-6 py-2 rounded-full border border-white/30 text-xs font-bold bg-white/10 text-white whitespace-nowrap">
                    ${cat}
                </button>
            `).join('');

            const container = document.getElementById('menu-container');
            container.innerHTML = categories.map(cat => `
                <div id="${cat}">
                    <h2 class="text-xl font-black mb-4 px-2 border-l-4 border-orange-600 ml-2 uppercase">&nbsp; ${cat}</h2>
                    <div class="space-y-4">
                        ${menuData.filter(item => item.category === cat).map(item => {
                            const qty = cart[item.id] || 0;
                            return `
                            <div class="bg-white p-4 rounded-[2rem] flex gap-4 shadow-sm border border-gray-50 items-center">
                                <div class="relative shrink-0">
                                    <img src="${item.img}" class="w-20 h-20 rounded-2xl object-cover bg-gray-100">
                                    ${item.label ? `<span class="absolute -top-2 -left-2 bg-red-600 text-white text-[8px] font-black px-2 py-1 rounded-md animate-pulse uppercase">${item.label}</span>` : ''}
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-1 mb-1">
                                        <span class="w-1.5 h-1.5 rounded-full ${item.type === 'Veg' ? 'bg-green-500' : 'bg-red-500'}"></span>
                                        <h3 class="font-black text-slate-800 text-sm tracking-tight leading-tight">${item.name}</h3>
                                    </div>
                                    <p class="text-[9px] text-gray-400 mb-1 line-clamp-1">${item.desc}</p>
                                    <p class="text-orange-600 font-black">‚Çπ${item.price}</p>
                                </div>
                                <div class="flex items-center gap-2 bg-gray-100 p-1.5 rounded-2xl shrink-0">
                                    <button onclick="updateQty(${item.id}, -1)" class="w-7 h-7 flex items-center justify-center bg-white rounded-xl font-bold shadow-sm">-</button>
                                    <span class="font-black text-sm w-4 text-center">${qty}</span>
                                    <button onclick="updateQty(${item.id}, 1)" class="w-7 h-7 flex items-center justify-center bg-orange-600 text-white rounded-xl font-bold shadow-sm">+</button>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
            `).join('');
        }

        function scrollToCategory(id) { document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'center' }); }

        function updateQty(id, change) {
            cart[id] = (cart[id] || 0) + change;
            if (cart[id] <= 0) delete cart[id];
            let total = 0;
            menuData.forEach(i => { if(cart[i.id]) total += i.price * cart[i.id]; });
            document.getElementById('total-price').innerText = total;
            document.getElementById('cart-bar').classList.toggle('hidden', total === 0);
            renderUI();
        }

        async function placeOrder() {
            const nameVal = document.getElementById('name').value;
            const tableVal = document.getElementById('table').value;
            if (!nameVal || !tableVal) return alert("Bhai, Naam aur Table number bhool gaye!");
            
            const invID = "VJ-" + Math.floor(Math.random() * 9000 + 1000);
            
            currentOrderID = invID;
            localStorage.setItem('activeVijayOrder', invID); 
            
            const itemsArr = [];
            menuData.forEach(i => { if(cart[i.id]) itemsArr.push(`${i.name} (${cart[i.id]})`); });
            const total = document.getElementById('total-price').innerText;
            const orderBtn = document.getElementById('orderBtn');

            orderBtn.innerText = "SENDING...";
            orderBtn.disabled = true;

            try {
                // 1. Google Sheet par order bhej rahe hain
                await fetch(SCRIPT_URL, { 
                    method: 'POST', mode: 'no-cors', 
                    body: JSON.stringify({ 
                        action: "add", invoice_no: invID, customer_name: nameVal, 
                        table_no: tableVal, items: itemsArr.join(', '), total_amount: total 
                    }) 
                });

                // üöÄ 2. TELEGRAM NOTIFICATION BHEJ RAHE HAIN
                const botToken = "8653026327:AAHGkq9vAEKaC-9PpoFaHqdNFWrJPKpHgco"; 
                const chatId = "7766518587";     
                const tgMessage = `üö® *NEW ORDER RECEIVED!* üö®\n\nüßæ *Invoice:* #${invID}\nüçΩ *Table:* ${tableVal}\nüë§ *Name:* ${nameVal}\nüì¶ *Items:* \n${itemsArr.join('\n')}\n\nüí∞ *Total:* ‚Çπ${total}`;
                
                const tgUrl = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(tgMessage)}&parse_mode=Markdown`;
                
                // Background mein chupke se Telegram ko hit karega
                fetch(tgUrl).catch(e => console.log("Telegram silent error"));
                
                // 3. UI Update (Success)
                orderBtn.innerText = "ORDER PLACED! ‚úÖ";
                orderBtn.classList.replace('bg-slate-900', 'bg-green-600');
                document.getElementById('track-float-btn').classList.remove('hidden');
                
                cart = {};
                document.getElementById('total-price').innerText = "0";
                document.getElementById('cart-bar').classList.add('hidden');
                renderUI();

                alert("Order kitchen mein pahunch gaya! Niche 'Track Status' button se check karein.");

            } catch (e) {
                orderBtn.innerText = "ORDER PLACED! ‚úÖ";
                orderBtn.classList.replace('bg-slate-900', 'bg-green-600');
                document.getElementById('track-float-btn').classList.remove('hidden');
                cart = {};
                renderUI();
            }
        }

        function goToTracking() {
            if(currentOrderID) {
                const timeStamp = new Date().getTime(); 
                window.location.href = "https://www.growft.online/tracorder/index.html?id=" + currentOrderID + "&v=" + timeStamp;
            }
        }

        fetchMenu();
    </script>
</body>
</html>
