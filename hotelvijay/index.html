<script>
        // YAHAN APNA NAYA WALA MASTER SCRIPT URL DALNA HAI
        const SCRIPT_URL = "https://docs.google.com/spreadsheets/d/1eoFiwdPp3bLiD7SptnFQovSCNDYAU99xrAGh8QPHfI0/edit?usp=sharing";
        
        let menuData = [];
        let cart = {};

        // Google Sheet se Menu Fetch Karna
        async function fetchMenu() {
            try {
                // SCRIPT_URL ke aage ?get=menu laga hai taaki sirf menu load ho
                const res = await fetch(SCRIPT_URL + "?get=menu");
                menuData = await res.json();
                renderUI();
            } catch (e) {
                console.error("Menu fetch failed:", e);
                document.getElementById('category-tabs').innerHTML = "<p class='text-xs text-red-200'>Menu failed to load!</p>";
            }
        }

        function renderUI() {
            const categories = [...new Set(menuData.map(item => item.category))];
            
            // Render Tabs
            const tabs = document.getElementById('category-tabs');
            tabs.innerHTML = categories.map(cat => `
                <button onclick="scrollToCategory('${cat}')" class="category-pill px-6 py-2 rounded-full border border-white/30 text-xs font-bold bg-white/10 text-white whitespace-nowrap">
                    ${cat}
                </button>
            `).join('');

            // Render Menu Items
            const container = document.getElementById('menu-container');
            container.innerHTML = categories.map(cat => `
                <div id="${cat}">
                    <h2 class="text-xl font-black mb-4 px-2 border-l-4 border-orange-600 ml-2 uppercase">&nbsp; ${cat}</h2>
                    <div class="space-y-4">
                        ${menuData.filter(item => item.category === cat).map(item => {
                            const qty = cart[item.id] || 0;
                            const typeColor = item.type === "Veg" ? "text-green-500" : "text-red-500";
                            return `
                            <div class="bg-white p-4 rounded-[2rem] flex gap-4 shadow-sm border border-gray-50 items-center">
                                <div class="relative shrink-0">
                                    <img src="${item.img}" class="w-20 h-20 rounded-2xl object-cover bg-gray-100 shadow-inner">
                                    ${item.label ? `<span class="absolute -top-2 -left-2 bg-red-600 text-white text-[8px] font-black px-2 py-1 rounded-md shadow-lg animate-pulse uppercase">${item.label}</span>` : ''}
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-1">
                                        <span class="text-[8px] ${typeColor}">●</span>
                                        <h3 class="font-black text-slate-800 text-sm tracking-tight">${item.name}</h3>
                                    </div>
                                    <p class="text-[9px] text-gray-400 font-medium mb-1 line-clamp-2">${item.desc}</p>
                                    <p class="text-orange-600 font-black">₹${item.price}</p>
                                </div>
                                <div class="flex items-center gap-2 bg-gray-100 p-1.5 rounded-2xl shrink-0">
                                    <button onclick="updateQty(${item.id}, -1)" class="w-8 h-8 bg-white rounded-xl font-bold shadow-sm">-</button>
                                    <span class="font-black text-sm w-4 text-center">${qty}</span>
                                    <button onclick="updateQty(${item.id}, 1)" class="w-8 h-8 bg-orange-600 text-white rounded-xl font-bold shadow-sm active:scale-90 transition-transform">+</button>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
            `).join('');
        }

        function scrollToCategory(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function updateQty(id, change) {
            cart[id] = (cart[id] || 0) + change;
            if (cart[id] <= 0) delete cart[id];
            
            let total = 0;
            menuData.forEach(i => { if(cart[i.id]) total += i.price * cart[i.id]; });
            
            document.getElementById('total-price').innerText = total;
            document.getElementById('cart-bar').classList.toggle('hidden', total === 0);
            renderUI();
        }

        async function placeOrder() {
            const nameVal = document.getElementById('name').value;
            const tableVal = document.getElementById('table').value;
            if (!nameVal || !tableVal) return alert("Bhai, Naam aur Table number bhool gaye!");
            
            const invID = "VJ-" + Math.floor(Math.random() * 9000 + 1000);
            const itemsArr = [];
            menuData.forEach(i => { if(cart[i.id]) itemsArr.push(`${i.name} (${cart[i.id]})`); });
            
            const total = document.getElementById('total-price').innerText;
            const orderBtn = document.getElementById('orderBtn');
            orderBtn.innerText = "SENDING...";
            orderBtn.disabled = true;

            try {
                // Ab data usi akele SCRIPT_URL par jayega
                await fetch(SCRIPT_URL, { 
                    method: 'POST', mode: 'no-cors', 
                    body: JSON.stringify({ 
                        action: "add", invoice_no: invID, customer_name: nameVal, 
                        table_no: tableVal, items: itemsArr.join(', '), total_amount: total 
                    }) 
                });
                window.location.href = "https://www.growft.online/tracorder/index.html?id=" + invID;
            } catch (e) {
                window.location.href = "https://www.growft.online/tracorder/index.html?id=" + invID;
            }
        }

        fetchMenu();
    </script>
