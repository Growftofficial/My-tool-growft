<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Review - Sukhada 24x7 Pet Hospital</title>
    <style>
        /* --- THEME: VETERINARY (Teal & White) --- */
        :root {
            --primary: #00897B; /* Teal */
            --primary-light: #26A69A;
            --accent: #00695C;
            --bg-color: #E0F2F1;
            --card-bg: #ffffff;
            --gold: #FBC02D;
            --gray: #455A64;
            --border: #B2DFDB;
            --box-bg: #F8FDFA;
            --whatsapp: #25D366;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px 10px;
            min-height: 100vh; display: flex;
            justify-content: center; align-items: flex-start;
        }

        .container {
            background: var(--card-bg); width: 100%; max-width: 500px;
            padding: 25px; border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 137, 123, 0.15);
            border-top: 6px solid var(--primary); margin: auto;
            text-align: center;
            position: relative;
        }

        /* --- üîí LOCK SCREEN --- */
        #lockScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        .contact-admin-btn {
            background: var(--primary); color: white; padding: 12px 25px;
            border-radius: 50px; text-decoration: none; font-weight: 600;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* HEADER */
        h1 { color: var(--accent); margin: 5px 0 5px 0; font-size: 22px; font-weight: 800; line-height: 1.2; }
        .subtitle { font-size: 12px; color: #666; margin-bottom: 10px; font-weight: 600; }
        .location { 
            color: var(--primary); font-size: 12px; font-weight: 700; 
            text-transform: uppercase; letter-spacing: 0.5px; 
            margin-bottom: 15px; display: inline-block; 
            background: #E0F2F1; padding: 5px 12px; border-radius: 15px;
        }
        .phone-link {
            text-decoration: none; color: #fff; background: var(--primary);
            padding: 8px 18px; border-radius: 25px; display: inline-block;
            font-size: 14px; font-weight: 700; transition: 0.2s;
            box-shadow: 0 4px 6px rgba(0, 137, 123, 0.2); margin-bottom: 20px;
        }

        /* INPUTS */
        select, input, textarea {
            width: 100%; padding: 12px; border-radius: 8px;
            border: 1px solid var(--border); background: var(--box-bg);
            font-size: 14px; outline: none; margin-bottom: 10px;
            color: #333; font-family: inherit;
        }
        select:focus, input:focus, textarea:focus { border-color: var(--primary); background: #fff; }
        label { font-weight: 700; display: block; margin-top: 12px; margin-bottom: 6px; color: var(--accent); font-size: 12px; text-transform: uppercase; text-align: left; }

        /* RATING */
        .star-container { display: flex; justify-content: center; gap: 8px; margin: 20px 0; }
        .star { font-size: 40px; color: #CFD8DC; cursor: pointer; transition: transform 0.2s; }
        .star.selected { color: var(--gold); transform: scale(1.1); }

        .experience-btns { display: flex; gap: 10px; margin-bottom: 25px; justify-content: center; }
        .exp-btn {
            padding: 12px 15px; border: 1px solid var(--border); border-radius: 8px;
            background: #fff; cursor: pointer; font-weight: 600; color: #546E7A;
            flex: 1; max-width: 140px; transition: 0.2s; font-size: 14px;
        }
        .exp-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* INPUT MODES */
        .input-mode-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .mode-btn { 
            flex: 1; padding: 10px; border: 1px solid var(--primary); border-radius: 8px; 
            background: #fff; color: var(--primary); font-weight: 600; cursor: pointer; font-size: 13px;
        }
        .mode-btn.active-mode { background: var(--primary); color: white; }

        .voice-section, .text-section {
            background: #E0F2F1; padding: 12px; border-radius: 12px; 
            margin-bottom: 20px; border: 1px dashed var(--primary); text-align: left;
        }
        .voice-controls { display: flex; align-items: center; gap: 10px; }
        .mic-btn {
            width: 45px; height: 45px; border-radius: 50%;
            background: var(--primary); color: white; border: none;
            font-size: 20px; cursor: pointer; box-shadow: 0 4px 10px rgba(0, 137, 123, 0.3);
            display: flex; align-items: center; justify-content: center;
        }
        .mic-active { animation: pulse 1.5s infinite; background: var(--danger); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 137, 123, 0.7); } 100% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } }

        /* CHIPS */
        .category-header { font-size: 11px; color: var(--accent); margin: 15px 0 8px 0; font-weight: 700; letter-spacing: 0.5px; border-bottom: 1px dashed #B2DFDB; padding-bottom: 4px; text-align: left; }
        .keywords-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 5px; }
        .keyword-chip { 
            padding: 8px 10px; background-color: #fff; border-radius: 20px; 
            font-size: 11px; font-weight: 600; cursor: pointer; 
            border: 1px solid #B2DFDB; color: #00695C; 
            flex-grow: 1; text-align: center; transition: 0.2s;
        }
        .keyword-chip.active { background-color: var(--primary); color: white; border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 3px 8px rgba(0, 137, 123, 0.2); }

        /* BUTTONS */
        .action-btn {
            width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 10px;
        }
        .copy-btn { width: 100%; padding: 12px; background-color: #F57F17; color: white; border: none; border-radius: 8px; margin-top: 15px; font-weight: 600; font-size: 15px; cursor: pointer; display: none; box-shadow: 0 4px 6px rgba(245, 127, 23, 0.2); }

        .review-preview-box {
            width: 100%; min-height: 130px; margin-top: 15px; border-radius: 8px; padding: 10px; 
            border: 1px solid var(--border); display: none; background: #fff; resize: none; outline: none;
        }

        /* OWNER PANEL */
        #ownerPanel {
            display: none; margin-top: 20px; padding: 15px;
            border: 2px dashed var(--whatsapp); border-radius: 12px;
            background-color: #f0fdf4; text-align: left;
        }
        .whatsapp-send-btn {
            width: 100%; padding: 12px; background-color: var(--whatsapp);
            color: white; border: none; border-radius: 8px;
            font-size: 15px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* UTILS */
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none !important; }
        .toggle-name { font-size: 13px; color: var(--primary); text-decoration: underline; cursor: pointer; float: right; margin-top: 5px; border: none; background: none; }

        /* FOOTER */
        .footer { margin-top: 35px; text-align: center; font-size: 12px; color: #64748b; border-top: 1px dashed #B2DFDB; padding-top: 15px; }
        .footer-logo { display: block; margin: 0 auto 5px auto; max-height: 28px; width: auto; opacity: 0.85; }
        .footer a { color: var(--primary); text-decoration: none; font-weight: 700; }
        .owner-login-trigger {
            font-size: 11px; color: #ccc; cursor: pointer; text-decoration: none;
            position: absolute; bottom: 5px; right: 10px;
        }
        
        .customer-card { text-align: center; padding: 20px; }
        .customer-card h2 { color: var(--primary); }
    </style>
</head>
<body>

<div id="lockScreen" style="display: none;">
    <div style="font-size: 60px; margin-bottom: 20px;">üîí</div>
    <div style="font-size: 22px; font-weight: 700; color: #333; margin-bottom: 10px;">Service Suspended</div>
    <div style="font-size: 14px; color: #666; margin-bottom: 30px;">
        This tool has been disabled. Please contact the administrator.
    </div>
    <a href="tel:+917020360561" class="contact-admin-btn">Contact Provider</a>
</div>

<div class="container" id="mainApp">

    <div id="customerLinkView" class="hidden customer-card">
        <div style="font-size: 40px; margin-bottom: 10px;">üêæ</div>
        <h2>Hello!</h2>
        <p style="color:#555; font-size:14px; margin-bottom:20px;">
            Here is the review for your pet's visit to Sukhada Hospital.
            <br>Click below to copy & post.
        </p>
        <textarea id="customerReviewText" class="review-preview-box" readonly style="display:block;"></textarea>
        <button class="copy-btn" style="display:block; margin-top:15px;" onclick="copyCustomerLinkReview()">üìã Copy & Open Google</button>
        <p style="font-size:11px; color:#999; margin-top:20px;">Wishing your pet good health! ‚ù§Ô∏è</p>
    </div>

    <div id="generatorApp">
        <h1>Sukhada 24x7 Multi Speciality Pet Hospital</h1>
        <div class="subtitle">Compassionate Care for Your Furry Friends</div>
        <div class="location">üìç Vaishali Nagar, Jaipur</div>
        
        <div style="text-align:center;">
            <a href="tel:+918003329626" class="phone-link">üìû Call Us Now</a>
        </div>

        <div id="ratingScreen" class="fade-in">
            <p>How was your experience?</p>
            <div class="star-container">
                <span class="star" onclick="rate(1)">‚òÖ</span>
                <span class="star" onclick="rate(2)">‚òÖ</span>
                <span class="star" onclick="rate(3)">‚òÖ</span>
                <span class="star" onclick="rate(4)">‚òÖ</span>
                <span class="star" onclick="rate(5)">‚òÖ</span>
            </div>
            <div class="experience-btns">
                <button class="exp-btn" id="btn-bad" onclick="selectExp('bad')">Issues üòû</button>
                <button class="exp-btn" id="btn-good" onclick="selectExp('good')">Great! üêæ</button>
            </div>
            <button class="action-btn" onclick="processRating()">Next Step ‚û°</button>
        </div>

        <div id="privateFeedbackScreen" class="hidden fade-in">
            <h2 style="color:#455A64;">We are sorry! üòî</h2>
            <p>Please tell us how we can improve.</p>
            <textarea id="privateFeedbackText" class="feedback-box" placeholder="Describe the issue..."></textarea>
            <button class="action-btn" style="background:#455A64;" onclick="submitPrivateFeedback()">Submit Feedback</button>
        </div>

        <div id="thankYouScreen" class="hidden fade-in">
            <div style="font-size: 50px; margin-bottom:10px;">‚úÖ</div>
            <h2 style="color:#455A64;">Thank You!</h2>
            <p>Your feedback has been submitted.</p>
        </div>

        <div id="aiToolScreen" class="hidden fade-in" style="text-align: left;">
            
            <div class="input-mode-tabs">
                <button class="mode-btn active-mode" id="btnModeVoice" onclick="switchMode('voice')">üé§ Speak</button>
                <button class="mode-btn" id="btnModeText" onclick="switchMode('text')">‚úçÔ∏è Write</button>
            </div>

            <div id="voiceSection" class="voice-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span style="font-size:11px; font-weight:bold; color:var(--primary);">SPEAK (Hindi/English):</span>
                    <select id="voiceLang" style="width:auto; padding:2px; font-size:11px; height:25px; margin:0;">
                        <option value="en-IN" selected>English</option>
                        <option value="hi-IN">Hindi</option>
                    </select>
                </div>
                <div class="voice-controls">
                    <button id="micBtn" class="mic-btn" onclick="startListening()">üé§</button>
                    <div style="flex:1;">
                        <p id="statusText" style="font-size:12px; color:#555; margin:0;">Tap mic & speak...<br>(Ex: "Doctor ne bahut ache se check kiya")</p>
                    </div>
                </div>
                <div id="spokenTextDisplay" style="display:none; margin-top:8px; font-size:12px; color:var(--primary); background:#fff; padding:6px; border-radius:4px;"></div>
            </div>

            <div id="textSection" class="text-section hidden">
                <label style="margin-top:0; color:var(--primary);">Describe Experience</label>
                <textarea id="manualInput" placeholder="Ex: Dr. was very polite..." style="height:80px; margin-bottom:0;"></textarea>
            </div>

            <label style="margin-top:0;">1. Select Location</label>
            <select id="locationSelect">
                <option value="Vaishali Nagar">Vaishali Nagar</option>
                <option value="Jaipur">Jaipur</option>
                <option value="Rajasthan">Rajasthan</option>
            </select>

            <div style="display: flex; gap: 10px;">
                <div style="flex:1;">
                    <label>2. Your Pet</label>
                    <select id="petSelect">
                        <option value="Dog">Dog üêï</option>
                        <option value="Cat">Cat üêà</option>
                        <option value="Rabbit">Rabbit üêá</option>
                        <option value="Turtle">Turtle üê¢</option>
                        <option value="Parrot">Parrot ü¶ú</option>
                        <option value="Goat">Goat üêê</option>
                        <option value="Exotic Pet">Exotic Pet ü¶é</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <label>3. Tone</label>
                    <select id="toneSelect">
                        <option value="Professional">Professional ü©∫</option>
                        <option value="Caring">Caring ‚ù§Ô∏è</option>
                        <option value="Short">Short üëå</option>
                        <option value="Grateful">Grateful üôè</option>
                    </select>
                </div>
            </div>

            <label>4. Reason for Visit (Optional)</label>
            <select id="treatmentSelect">
                <option value="">-- General Checkup --</option>
                <option value="flea and tick removal">Flea/Tick Removal</option>
                <option value="skin infection treatment">Skin Infection Treatment</option>
                <option value="dental cleaning">Dental Disease/Cleaning</option>
                <option value="broken teeth repair">Broken Teeth Repair</option>
                <option value="deworming">Deworming</option>
                <option value="kidney function test">Kidney Function Test</option>
                <option value="Rabies vaccination">Rabies Vaccination</option>
                <option value="respiratory issue treatment">Respiratory Issue</option>
                <option value="hair loss treatment">Hair Loss/Ringworm</option>
                <option value="emergency surgery">Emergency Surgery</option>
                <option value="allergy testing">Allergy Testing</option>
                <option value="first puppy visit">Puppy First Visit</option>
            </select>

            <div><button class="toggle-name" onclick="toggleNameField()">+ Add Your Name</button></div>
            <div id="nameArea" style="display:none; clear:both; margin-top:5px;">
                <input type="text" id="userName" placeholder="Your Name (Optional)">
            </div>

            <label style="clear:both;">5. Select Highlights (Pick 3-4)</label>

            <div id="keywordsWrapper">
                <div id="customCategory" class="hidden">
                    <div class="category-header">üÜï LATEST UPDATES (FROM ADMIN)</div>
                    <div class="keywords-container" id="customContainer"></div>
                </div>

                <div class="category-header">CORE SERVICES</div>
                <div class="keywords-container">
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Best Animal hospital')">üè• Best Animal Hospital</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Best pet hospital')">üêæ Best Pet Hospital</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, '24x7 pet hospital')">üöë 24x7 Emergency</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Best vet in Jaipur')">ü•á Best Vet in Jaipur</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Best Veterinarian')">üë®‚Äç‚öïÔ∏è Expert Doctor</div>
                </div>

                <div class="category-header">VACCINATION & HEALTH</div>
                <div class="keywords-container">
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Dog vaccination')">üíâ Dog Vaccination</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet vaccination')">üíâ Pet Vaccination</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet allergy testing')">ü§ß Allergy Testing</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet dental clinic')">ü¶∑ Dental Clinic</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Puppy/Kitten first vet visit')">üçº Puppy/Kitten First Visit</div>
                </div>

                <div class="category-header">FACILITIES</div>
                <div class="keywords-container">
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet insurance')">üìÑ Pet Insurance</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Quality pet food')">ü•© Quality Pet Food</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Dog hospital')">üêï Dog Hospital</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'cat hospital')">üêà Cat Hospital</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Exotic animal vet')">ü¶é Exotic Animal Vet</div>
                </div>
            </div>

            <button class="action-btn" id="generateBtn" onclick="generateReview()">üöÄ Generate Review</button>

            <textarea id="reviewOutput" class="review-preview-box" readonly></textarea>
            
            <button class="copy-btn" id="copyBtn" onclick="copyToClipboard()">üìã Copy & Open Google</button>

            <div id="ownerPanel">
                <label style="color:var(--whatsapp); margin-top:0;">üì± Customer's WhatsApp Number</label>
                <div style="display:flex; gap:10px;">
                    <input type="tel" id="customerPhone" placeholder="Ex: 9876543210" style="margin-bottom:0;">
                    <button class="whatsapp-send-btn" style="width: auto; padding: 0 20px;" onclick="sendLinkToCustomer()">üöÄ Send</button>
                </div>
                <p style="font-size:11px; color:#555; margin-top:5px;">Customer will receive a direct link to post this review.</p>
            </div>

        </div>
    </div>

    <div class="footer">
        <img src="https://growft.odoo.com/web/image/1477-e0a28764/growft%20logo.webp" class="footer-logo" alt="Growft" loading="lazy">
        <div class="footer-text">
            Powered by <a href="https://growft.net" target="_blank">Growft</a>
        </div>
        <span class="owner-login-trigger" onclick="ownerLogin()">üîí Owner</span>
    </div>
</div>

<script>
    // --- ‚úÖ FIXED LINK (Correct CSV Format) ---
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQrWLyNviRTqBdRYgd0gJXyoOl16b8iBt9GZI4ijpUAcTAUN_tAuwVuc-Glg_4y6a-W9Dr9Hk4AT3qu/pub?gid=0&single=true&output=csv";

    // --- üîê SECURITY & CONFIGURATION ---
    const GOOGLE_REVIEW_LINK = "https://g.page/r/CQr2QAKYuPShEBM/review"; 
    const APP_STATUS = "active"; 
    const EXPIRY_DATE = "2026-12-31"; 

    // --- INITIALIZATION ---
    let isOwnerMode = false;
    let recognition; 

    window.onload = function() {
        // Security Check
        const today = new Date().toISOString().split('T')[0];
        if(APP_STATUS === "suspended" || today > EXPIRY_DATE) {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('lockScreen').style.display = 'flex';
            return;
        }

        // Fetch Keywords
        fetchKeywordsFromSheet();

        // URL Check
        const urlParams = new URLSearchParams(window.location.search);
        const reviewText = urlParams.get('review');
        if (reviewText) {
            document.getElementById('generatorApp').style.display = 'none';
            document.getElementById('customerLinkView').classList.remove('hidden');
            document.getElementById('customerReviewText').value = decodeURIComponent(reviewText);
        } else if(sessionStorage.getItem('isOwner') === 'true') {
            isOwnerMode = true;
        }
    };

    // --- FETCH DATA FUNCTION ---
    function fetchKeywordsFromSheet() {
        // Cache Buster to force update
        const cacheBuster = "&t=" + new Date().getTime(); 
        const finalURL = SHEET_CSV_URL + cacheBuster;

        console.log("Fetching from:", finalURL); 

        fetch(finalURL)
            .then(response => {
                if (!response.ok) throw new Error("Network response was not ok");
                return response.text();
            })
            .then(data => {
                // Check if data is HTML (Wrong Link Error)
                if(data.trim().startsWith("<!DOCTYPE")) {
                    console.error("Error: Link is HTML, not CSV");
                    return;
                }

                const rows = data.split('\n');
                const customContainer = document.getElementById('customContainer');
                const customCategory = document.getElementById('customCategory');
                
                customContainer.innerHTML = '';
                let hasData = false;

                // Loop through rows (Start at 1 to skip header)
                for(let i = 1; i < rows.length; i++) {
                    let keyword = rows[i].trim();
                    // Clean quotes if CSV adds them
                    if(keyword.startsWith('"') && keyword.endsWith('"')) {
                        keyword = keyword.slice(1, -1);
                    }
                    // Clean extra commas
                    keyword = keyword.replace(/,/g, '').trim();
                    
                    if(keyword) {
                        hasData = true;
                        createChipElement(keyword);
                    }
                }

                if(hasData) {
                    customCategory.classList.remove('hidden');
                } else {
                    console.log("Sheet Connected but Empty");
                }
            })
            .catch(error => console.error('Error fetching sheet:', error));
    }

    function createChipElement(text) {
        const container = document.getElementById('customContainer');
        const newChip = document.createElement('div');
        newChip.className = 'keyword-chip';
        newChip.innerText = "üÜï " + text;
        newChip.onclick = function() { toggleKeyword(this, text); };
        container.appendChild(newChip);
    }

    // --- OWNER & WHATSAPP LOGIC ---
    function ownerLogin() {
        if(isOwnerMode) { alert("Already logged in as Owner."); return; }
        const password = prompt("Enter Owner Password:");
        if(password === "admin123") { 
            isOwnerMode = true;
            sessionStorage.setItem('isOwner', 'true');
            alert("Owner Mode Active!");
        } else if(password) { alert("Incorrect Password"); }
    }

    function sendLinkToCustomer() {
        const phone = document.getElementById('customerPhone').value.replace(/\D/g, '');
        const review = document.getElementById('reviewOutput').value;
        if(phone.length < 10) { alert("Enter valid number"); return; }
        const finalPhone = phone.length === 10 ? "91" + phone : phone;
        const baseUrl = window.location.href.split('?')[0];
        const magicLink = `${baseUrl}?review=${encodeURIComponent(review)}`;
        const msg = `Namaste! üôè\n\nHere is the review for your pet's visit to Sukhada Hospital:\n\n*Tap this link to Post:*\n${magicLink}`;
        window.open(`https://wa.me/${finalPhone}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function copyCustomerLinkReview() {
        const box = document.getElementById("customerReviewText");
        box.select();
        document.execCommand('copy');
        window.open(GOOGLE_REVIEW_LINK, '_blank');
    }

    // --- APP LOGIC ---
    let selectedKeywords = [];
    let voiceText = "";
    let activeMode = 'voice';

    function switchMode(mode) {
        activeMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active-mode'));
        if(mode === 'voice') {
            document.getElementById('btnModeVoice').classList.add('active-mode');
            document.getElementById('voiceSection').classList.remove('hidden');
            document.getElementById('textSection').classList.add('hidden');
        } else {
            document.getElementById('btnModeText').classList.add('active-mode');
            document.getElementById('textSection').classList.remove('hidden');
            document.getElementById('voiceSection').classList.add('hidden');
        }
    }

    // Rating Logic
    let currentRating = 0;
    let currentExp = '';
    function rate(stars) {
        currentRating = stars;
        document.querySelectorAll('.star').forEach((star, index) => {
            star.classList.toggle('selected', index < stars);
        });
        if(stars >= 4) selectExp('good'); else selectExp('bad');
    }
    function selectExp(type) {
        currentExp = type;
        document.getElementById('btn-good').classList.remove('active');
        document.getElementById('btn-bad').classList.remove('bad-active');
        if (type === 'good') document.getElementById('btn-good').classList.add('active');
        else document.getElementById('btn-bad').classList.add('bad-active');
    }
    function processRating() {
        if (currentRating === 0 && currentExp === '') { alert("Please select a star rating."); return; }
        document.getElementById('ratingScreen').classList.add('hidden');
        let isHappy = (currentRating >= 4) || (currentExp === 'good');
        if (isHappy) document.getElementById('aiToolScreen').classList.remove('hidden');
        else document.getElementById('privateFeedbackScreen').classList.remove('hidden');
    }
    function submitPrivateFeedback() {
        document.getElementById('privateFeedbackScreen').classList.add('hidden');
        document.getElementById('thankYouScreen').classList.remove('hidden');
    }

    // Voice Logic
    function startListening() {
        if (!('webkitSpeechRecognition' in window)) { alert("Use Chrome Browser."); return; }
        recognition = new webkitSpeechRecognition();
        recognition.lang = document.getElementById('voiceLang').value;
        recognition.interimResults = false;
        document.getElementById('micBtn').classList.add('mic-active');
        document.getElementById('statusText').innerText = "Listening...";
        recognition.onresult = (event) => {
            voiceText = event.results[0][0].transcript;
            document.getElementById('spokenTextDisplay').style.display = 'block';
            document.getElementById('spokenTextDisplay').innerText = `Recorded: "${voiceText}"`;
        };
        recognition.onend = () => { document.getElementById('micBtn').classList.remove('mic-active'); document.getElementById('statusText').innerText = "Processing..."; };
        recognition.start();
    }

    async function generateReview() {
        const btn = document.getElementById('generateBtn');
        btn.innerText = "üîÑ Processing...";
        
        const userName = document.getElementById('userName').value.trim();
        const tone = document.getElementById('toneSelect').value;
        const location = document.getElementById('locationSelect').value;
        const petType = document.getElementById('petSelect').value;
        const treatment = document.getElementById('treatmentSelect').value;
        const manualText = document.getElementById('manualInput').value.trim();
        let rawInput = activeMode === 'voice' ? voiceText : manualText;

        if (selectedKeywords.length === 0 && !rawInput) {
            alert("Please select highlights or say something.");
            btn.innerText = "üöÄ Generate Review";
            return;
        }

        // Translation
        let finalBodyText = "";
        if (rawInput && rawInput.length > 1) {
            try {
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(rawInput)}&langpair=Autodetect|en`);
                const data = await res.json();
                let translated = data.responseData ? data.responseData.translatedText : "";
                if(!translated.includes("PLEASE SELECT")) finalBodyText = translated;
                else finalBodyText = rawInput;
            } catch(e) { finalBodyText = rawInput; }
        }

        // Generation
        let treatmentText = treatment ? treatment : "regular checkup";
        let intro = getRandom(reviewDB.intros[tone]);
        intro = intro.replace(/{location}/g, location).replace(/{pet}/g, petType.toLowerCase()).replace(/{treatment}/g, treatmentText);
        if (userName) intro = `I am ${userName}. ` + intro;

        let body = "";
        const shuffledKeywords = selectedKeywords.sort(() => Math.random() - 0.5);
        shuffledKeywords.forEach((k) => {
            if(reviewDB.keywords[k]) {
                let sentence = getRandom(reviewDB.keywords[k]);
                sentence = sentence.replace(/{location}/g, location).replace(/{pet}/g, petType.toLowerCase());
                body += sentence + " ";
            } else {
                const generics = [
                    `I was really impressed with the ${k}.`,
                    `The ${k} was excellent.`,
                    `Also, ${k} is worth mentioning.`,
                    `I happily recommend their ${k}.`
                ];
                body += getRandom(generics) + " ";
            }
        });

        if(finalBodyText) body += " " + finalBodyText + ". ";

        let outro = getRandom(reviewDB.outros[tone]);
        outro = outro.replace(/{location}/g, location).replace(/{pet}/g, petType.toLowerCase());

        const finalReview = intro + " " + body + outro;

        const box = document.getElementById('reviewOutput');
        box.value = finalReview;
        box.style.display = 'block';
        box.scrollIntoView({behavior: "smooth"});
        btn.innerText = "üöÄ Generate Review";

        if(isOwnerMode) {
            document.getElementById('ownerPanel').style.display = 'block';
            document.getElementById('copyBtn').style.display = 'none';
        } else {
            document.getElementById('ownerPanel').style.display = 'none';
            document.getElementById('copyBtn').style.display = 'block';
        }
    }

    function toggleKeyword(element, keyword) {
        element.classList.toggle('active');
        if (selectedKeywords.includes(keyword)) selectedKeywords = selectedKeywords.filter(k => k !== keyword);
        else selectedKeywords.push(keyword);
    }
    
    function toggleNameField() { 
        const field = document.getElementById('nameArea');
        field.style.display = field.style.display === 'block' ? 'none' : 'block';
    }

    function copyToClipboard() {
        const box = document.getElementById("reviewOutput");
        box.select();
        document.execCommand('copy');
        if(confirm("Review Copied! Open Google Maps?")) window.open(GOOGLE_REVIEW_LINK, '_blank');
    }
    
    function getRandom(arr) { if(!arr) return ""; return arr[Math.floor(Math.random() * arr.length)]; }

    // --- MASSIVE DATABASE (30k+ Combo Ready) ---
    const reviewDB = {
        intros: {
            "Professional": [
                "I visited Sukhada Pet Hospital in {location} for my {pet}.",
                "Sukhada 24x7 Multi Speciality Pet Hospital provides excellent medical care in {location}.",
                "For reliable veterinary services in {location}, this is the best place.",
                "Professional and hygienic environment at this clinic in {location}.",
                "I highly recommend Dr. and the team at Sukhada Hospital, {location}.",
                "We had a very professional experience with our {pet} here.",
                "The medical facilities at this {location} hospital are top-notch.",
                "Impressed by the diagnosis for {treatment} provided in {location}.",
                "Standard of care is excellent at Sukhada Pet Hospital.",
                "If you need an expert vet in {location}, look no further.",
                "This clinic sets the benchmark for veterinary care in {location}.",
                "Extremely knowledgeable staff and doctors at Sukhada Hospital.",
                "The administrative and medical process here is seamless.",
                "Sukhada Hospital is the premier choice for pet care in {location}.",
                "I brought my {pet} for a checkup and was impressed by the professionalism.",
                "The expertise of the veterinarians here is commendable.",
                "Clean, organized, and professional service for my {pet}.",
                "Efficient handling of my {pet}'s case in {location}.",
                "Trusted veterinary advice given by the doctors here.",
                "The clinic follows high standards of hygiene and care."
            ],
            "Caring": [
                "The doctors here treated my {pet} with so much love! ‚ù§Ô∏è",
                "Best place for pets in {location}! They truly care.",
                "My {pet} was so comfortable with the doctor in {location}.",
                "Such a warm and welcoming clinic in {location}.",
                "They treated my little {pet} like their own family.",
                "Amazing experience! The staff is so kind and helpful.",
                "So happy to find such a caring pet hospital in {location}.",
                "My {pet} usually hates the vet, but was calm here!",
                "Lovely experience at Sukhada Hospital, {location}.",
                "Big thanks to the team for being so gentle with my {pet}.",
                "They handled my scared {pet} with so much patience.",
                "The love and care they show to animals is heartwarming.",
                "Felt like my {pet} was in safe hands immediately.",
                "The doctor took time to explain everything with kindness.",
                "Super friendly staff who love animals genuinely.",
                "My {pet} received lots of cuddles during the checkup!",
                "It's rare to find such compassionate vets in {location}.",
                "Thank you for being so sweet to my furry friend.",
                "The atmosphere here is full of positivity and care.",
                "My {pet} came back happy, which says it all!"
            ],
            "Short": [
                "Best pet hospital in {location}.",
                "Great service for my {pet}.",
                "Excellent veterinary clinic.",
                "Good doctor and staff.",
                "Recommended for all pet owners.",
                "Fast and good treatment.",
                "Very clean clinic in {location}.",
                "Best vet in town.",
                "Quality care for pets.",
                "Happy with the service.",
                "Quick and effective.",
                "Nice staff.",
                "Professional service.",
                "My go-to vet.",
                "5-star experience.",
                "Top notch clinic.",
                "Reasonable prices.",
                "Helpful doctor.",
                "Clean environment.",
                "Simply the best."
            ],
            "Grateful": [
                "I am so grateful to Sukhada Hospital for treating my {pet} in {location}.",
                "They were available 24x7 when my {pet} needed help with {treatment}.",
                "Thank you for the quick diagnosis and treatment.",
                "God bless the doctor for helping my {pet} recover.",
                "I don't know what I would have done without them in {location}.",
                "Heartfelt thanks to the entire team.",
                "Best emergency care for animals in {location}.",
                "Truly thankful for their support during a tough time.",
                "Thanks for guiding us properly regarding my {pet}'s health.",
                "A life-saver hospital in {location}.",
                "Words cannot express my gratitude for saving my {pet}.",
                "Thank you for answering my late-night calls.",
                "Grateful for the honest advice given by the doctor.",
                "They went above and beyond for my {pet}.",
                "Thanks for the successful surgery.",
                "We are forever thankful to the team.",
                "Thank you for giving my {pet} a second chance.",
                "Deeply appreciate the care provided in emergency.",
                "Thank you for treating us with so much respect.",
                "A blessing for pet owners in {location}."
            ]
        },
        keywords: {
            "Best Animal hospital": [
                "This is the best animal hospital in {location} with modern facilities.", 
                "Hands down the best animal hospital for comprehensive care.", 
                "Finding the best animal hospital was hard until we came here.",
                "Sukhada stands out as the best animal hospital in the region.",
                "If you want the best animal hospital experience, this is it."
            ],
            "Best pet hospital": [
                "Truly the best pet hospital I have visited for my {pet}.",
                "Ranked as the best pet hospital in {location} for a reason.",
                "Excellent facilities make it the best pet hospital nearby.",
                "We trust only this place, the best pet hospital in town.",
                "The best pet hospital for detailed checkups."
            ],
            "Best pet hospital": [
                 "Consistently providing service that makes them the best pet hospital.",
                 "My search for the best pet hospital ended here.",
                 "Professionalism defines this best pet hospital.",
                 "Highly rated as the best pet hospital for emergencies.",
                 "The staff makes this the best pet hospital."
            ],
             "Dog vaccination": [
                "Came here for dog vaccination, very smooth process.", 
                "Painless dog vaccination carried out by the expert.", 
                "They maintain a proper schedule for dog vaccination.",
                "Got my puppy's dog vaccination done here, very gentle.",
                "Best place for timely dog vaccination in {location}."
            ],
            "Pet dental clinic": [
                "The pet dental clinic facilities here are advanced.",
                "Looking for a pet dental clinic? This is the one.",
                "Their pet dental clinic solved my dog's bad breath issue.",
                "Expert pet dental clinic services at reasonable rates.",
                "Highly specialized pet dental clinic for cleaning and surgery."
            ],
            "Pet vaccination": [
                "Essential pet vaccination done at affordable rates.", 
                "Very professional handling during pet vaccination.", 
                "Timely pet vaccination reminders are helpful.",
                "Ensured my {pet} was calm during pet vaccination.",
                "Complete range of pet vaccination available."
            ],
            "Pet insurance": [
                "They helped me with Pet insurance for dogs claims.", 
                "Accepts Pet insurance which is great for costly treatments.", 
                "Explained the benefits of Pet insurance clearly.",
                "Smooth processing of cashless Pet insurance.",
                "Great to see a clinic supporting Pet insurance."
            ],
            "Quality pet food": [
                "They also recommend the best Quality pet food.", 
                "Got Quality pet food prescribed specifically for my {pet}.", 
                "Wide range of Quality pet food available at the clinic.",
                "The doctor guided me on Quality pet food for better health.",
                "Stocked with premium Quality pet food brands."
            ],
            "Dog hospital": [
                "The best Dog hospital in the city for all breeds.", 
                "Treats all issues, amazing Dog hospital.", 
                "My dog recovered quickly thanks to this Dog hospital.",
                "Specialized facilities available at this Dog hospital.",
                "A trusted Dog hospital for surgeries and general care."
            ],
            "cat hospital": [
                "Finally found a dedicated cat hospital service.",
                "They understand feline behavior well at this cat hospital.",
                "Quiet area for cats, great cat hospital environment.",
                "Best cat hospital in {location} for my kitty.",
                "Expert handling at this cat hospital."
            ],
            "24x7 pet hospital": [
                "A true 24x7 pet hospital that is always open.",
                "Thank god for this 24x7 pet hospital during emergencies.",
                "Reliable 24x7 pet hospital for late-night issues.",
                "Always accessible, the best 24x7 pet hospital.",
                "Peace of mind knowing there is a 24x7 pet hospital nearby."
            ],
            "Best Veterinarian": [
                "We met the Best Veterinarian for our {pet} here.",
                "Dr. is the Best Veterinarian in {location} hands down.",
                "Knowledgeable and kind, truly the Best Veterinarian.",
                "Lucky to have found the Best Veterinarian for our fur baby.",
                "Recommended by many as the Best Veterinarian in town."
            ],
            "Best vet in Jaipur": [
                "Undoubtedly the Best vet in Jaipur for small animals.",
                "Search no more for the Best vet in Jaipur.",
                "Visiting the Best vet in Jaipur changed our pet's health.",
                "Highly experienced, the Best vet in Jaipur.",
                "Top-class treatment from the Best vet in Jaipur."
            ],
            "Emergency vet in jaipur": [
                "The most responsive Emergency vet in jaipur.",
                "Saved my pet's life, best Emergency vet in jaipur.",
                "Quick action by the Emergency vet in jaipur team.",
                "Available at odd hours, reliable Emergency vet in jaipur.",
                "Critical care provided by the Emergency vet in jaipur."
            ],
            "Puppy/Kitten first vet visit": [
                "Perfect place for a Puppy/Kitten first vet visit.",
                "Made our Puppy/Kitten first vet visit very special.",
                "Guided us well during the Puppy/Kitten first vet visit.",
                "Got a health chart during the Puppy/Kitten first vet visit.",
                "Zero stress during the Puppy/Kitten first vet visit."
            ],
            "Pet allergy testing": [
                "Accurate Pet allergy testing diagnosed the itching.",
                "Advanced Pet allergy testing available here.",
                "Solved skin issues with Pet allergy testing.",
                "The doctor suggested Pet allergy testing which helped.",
                "Relief for my pet after Pet allergy testing."
            ],
            "Exotic animal vet": [
                "Hard to find an Exotic animal vet, but they are here.",
                "Great knowledge as an Exotic animal vet.",
                "Treated my turtle/rabbit well, expert Exotic animal vet.",
                "Specialized care from the Exotic animal vet.",
                "Best Exotic animal vet in {location}."
            ]
        },
        outros: {
            "Professional": [
                "I recommend them for all veterinary needs.",
                "A trustworthy medical center for animals.",
                "Will definitely continue our treatment here.",
                "The best choice for pet healthcare in {location}.",
                "Highly professional and recommended.",
                "Clean premises and knowledgeable staff.",
                "Satisfaction guaranteed with their service.",
                "One of the best clinics in Rajasthan.",
                "Do visit for quality pet care.",
                "Five stars for the professionalism.",
                "Efficient and effective treatment.",
                "A clinic that maintains high standards.",
                "Trust them with your pet's life.",
                "State-of-the-art facilities available.",
                "Best medical advice provided.",
                "Smooth experience from start to finish.",
                "Transparent pricing and good service.",
                "Highly qualified doctors.",
                "Excellent infrastructure.",
                "The go-to place for serious issues."
            ],
            "Caring": [
                "My {pet} is happy and healthy now! üêæ",
                "Will surely visit again for checkups.",
                "Thanks for making my {pet} feel safe.",
                "Best wishes to the amazing team.",
                "Love this place! ‚ù§Ô∏è",
                "Keep up the great work.",
                "Highly recommended to all pet parents.",
                "See you soon for the next vaccine.",
                "A happy place for pets.",
                "So glad we found you!",
                "Big hugs to the doctor.",
                "My pet actually likes coming here!",
                "Thanks for the treats and love.",
                "You guys are the best!",
                "Wonderful experience overall.",
                "Can't thank you enough.",
                "Feeling relieved and happy.",
                "Superb care for fur babies.",
                "Thanks for being so gentle.",
                "We love Sukhada Hospital!"
            ],
            "Short": [
                "Highly recommended.",
                "5 Stars.",
                "Best in {location}.",
                "Great job.",
                "Must visit.",
                "Good prices.",
                "Top quality.",
                "Very satisfied.",
                "Thank you.",
                "Superb service.",
                "Nice clinic.",
                "Good vet.",
                "Happy pet.",
                "Fast service.",
                "Clean place.",
                "Well done.",
                "Trusted vet.",
                "Recommended.",
                "Great care.",
                "Awesome."
            ],
            "Grateful": [
                "Thank you once again.",
                "Forever grateful for your help.",
                "I will always recommend Sukhada Hospital.",
                "Thanks for being there 24x7.",
                "Appreciate the emergency support.",
                "Thanks for saving us.",
                "Grateful for the reasonable rates too.",
                "You guys are angels for animals.",
                "Much appreciated.",
                "Thanks for the peace of mind.",
                "God bless the team.",
                "A heartfelt thank you.",
                "You saved my best friend.",
                "Can't thank you enough for the support.",
                "Thanks for the late night help.",
                "Respect for your dedication.",
                "Thank you for listening.",
                "Grateful for the kindness.",
                "Thanks for the quick recovery.",
                "Life savers."
            ]
        }
    };
</script>

</body>
</html>
