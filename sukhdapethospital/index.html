<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Review - Sukhada 24x7 Pet Hospital</title>
    <style>
        /* --- THEME: VETERINARY (Teal & White) --- */
        :root {
            --primary: #00897B; /* Teal */
            --primary-light: #26A69A;
            --accent: #00695C;
            --bg-color: #E0F2F1;
            --card-bg: #ffffff;
            --gold: #FBC02D;
            --gray: #455A64;
            --border: #B2DFDB;
            --box-bg: #F8FDFA;
            --whatsapp: #25D366;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px 10px;
            min-height: 100vh; display: flex;
            justify-content: center; align-items: flex-start;
        }

        .container {
            background: var(--card-bg); width: 100%; max-width: 500px;
            padding: 25px; border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 137, 123, 0.15);
            border-top: 6px solid var(--primary); margin: auto;
            text-align: center;
            position: relative;
        }

        /* --- üîí LOCK SCREEN --- */
        #lockScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        .contact-admin-btn {
            background: var(--primary); color: white; padding: 12px 25px;
            border-radius: 50px; text-decoration: none; font-weight: 600;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* HEADER */
        h1 { color: var(--accent); margin: 5px 0 5px 0; font-size: 22px; font-weight: 800; line-height: 1.2; }
        .subtitle { font-size: 12px; color: #666; margin-bottom: 10px; font-weight: 600; }
        .location { 
            color: var(--primary); font-size: 12px; font-weight: 700; 
            text-transform: uppercase; letter-spacing: 0.5px; 
            margin-bottom: 15px; display: inline-block; 
            background: #E0F2F1; padding: 5px 12px; border-radius: 15px;
        }
        .phone-link {
            text-decoration: none; color: #fff; background: var(--primary);
            padding: 8px 18px; border-radius: 25px; display: inline-block;
            font-size: 14px; font-weight: 700; transition: 0.2s;
            box-shadow: 0 4px 6px rgba(0, 137, 123, 0.2); margin-bottom: 20px;
        }

        /* INPUTS */
        select, input, textarea {
            width: 100%; padding: 12px; border-radius: 8px;
            border: 1px solid var(--border); background: var(--box-bg);
            font-size: 14px; outline: none; margin-bottom: 10px;
            color: #333; font-family: inherit;
        }
        select:focus, input:focus, textarea:focus { border-color: var(--primary); background: #fff; }
        label { font-weight: 700; display: block; margin-top: 12px; margin-bottom: 6px; color: var(--accent); font-size: 12px; text-transform: uppercase; text-align: left; }

        /* RATING */
        .star-container { display: flex; justify-content: center; gap: 8px; margin: 20px 0; }
        .star { font-size: 40px; color: #CFD8DC; cursor: pointer; transition: transform 0.2s; }
        .star.selected { color: var(--gold); transform: scale(1.1); }

        .experience-btns { display: flex; gap: 10px; margin-bottom: 25px; justify-content: center; }
        .exp-btn {
            padding: 12px 15px; border: 1px solid var(--border); border-radius: 8px;
            background: #fff; cursor: pointer; font-weight: 600; color: #546E7A;
            flex: 1; max-width: 140px; transition: 0.2s; font-size: 14px;
        }
        .exp-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* INPUT MODES */
        .input-mode-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .mode-btn { 
            flex: 1; padding: 10px; border: 1px solid var(--primary); border-radius: 8px; 
            background: #fff; color: var(--primary); font-weight: 600; cursor: pointer; font-size: 13px;
        }
        .mode-btn.active-mode { background: var(--primary); color: white; }

        .voice-section, .text-section {
            background: #E0F2F1; padding: 12px; border-radius: 12px; 
            margin-bottom: 20px; border: 1px dashed var(--primary); text-align: left;
        }
        .voice-controls { display: flex; align-items: center; gap: 10px; }
        .mic-btn {
            width: 45px; height: 45px; border-radius: 50%;
            background: var(--primary); color: white; border: none;
            font-size: 20px; cursor: pointer; box-shadow: 0 4px 10px rgba(0, 137, 123, 0.3);
            display: flex; align-items: center; justify-content: center;
        }
        .mic-active { animation: pulse 1.5s infinite; background: var(--danger); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 137, 123, 0.7); } 100% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } }

        /* CHIPS */
        .category-header { font-size: 11px; color: var(--accent); margin: 15px 0 8px 0; font-weight: 700; letter-spacing: 0.5px; border-bottom: 1px dashed #B2DFDB; padding-bottom: 4px; text-align: left; }
        .keywords-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 5px; }
        .keyword-chip { 
            padding: 8px 10px; background-color: #fff; border-radius: 20px; 
            font-size: 11px; font-weight: 600; cursor: pointer; 
            border: 1px solid #B2DFDB; color: #00695C; 
            flex-grow: 1; text-align: center; transition: 0.2s;
        }
        .keyword-chip.active { background-color: var(--primary); color: white; border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 3px 8px rgba(0, 137, 123, 0.2); }

        /* BUTTONS */
        .action-btn {
            width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 10px;
        }
        .copy-btn { width: 100%; padding: 12px; background-color: #F57F17; color: white; border: none; border-radius: 8px; margin-top: 15px; font-weight: 600; font-size: 15px; cursor: pointer; display: none; box-shadow: 0 4px 6px rgba(245, 127, 23, 0.2); }

        .review-preview-box {
            width: 100%; min-height: 130px; margin-top: 15px; border-radius: 8px; padding: 10px; 
            border: 1px solid var(--border); display: none; background: #fff; resize: none; outline: none;
        }

        /* OWNER PANEL */
        #ownerPanel {
            display: none; margin-top: 20px; padding: 15px;
            border: 2px dashed var(--whatsapp); border-radius: 12px;
            background-color: #f0fdf4; text-align: left;
        }
        .whatsapp-send-btn {
            width: 100%; padding: 12px; background-color: var(--whatsapp);
            color: white; border: none; border-radius: 8px;
            font-size: 15px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* UTILS */
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none !important; }
        .toggle-name { font-size: 13px; color: var(--primary); text-decoration: underline; cursor: pointer; float: right; margin-top: 5px; border: none; background: none; }

        /* FOOTER */
        .footer { margin-top: 35px; text-align: center; font-size: 12px; color: #64748b; border-top: 1px dashed #B2DFDB; padding-top: 15px; }
        .footer-logo { display: block; margin: 0 auto 5px auto; max-height: 28px; width: auto; opacity: 0.85; }
        .footer a { color: var(--primary); text-decoration: none; font-weight: 700; }
        .owner-login-trigger {
            font-size: 11px; color: #ccc; cursor: pointer; text-decoration: none;
            position: absolute; bottom: 5px; right: 10px;
        }
        
        .customer-card { text-align: center; padding: 20px; }
        .customer-card h2 { color: var(--primary); }
    </style>
</head>
<body>

<div id="lockScreen" style="display: none;">
    <div style="font-size: 60px; margin-bottom: 20px;">üîí</div>
    <div style="font-size: 22px; font-weight: 700; color: #333; margin-bottom: 10px;">Service Suspended</div>
    <div style="font-size: 14px; color: #666; margin-bottom: 30px;">
        This tool has been disabled. Please contact the administrator.
    </div>
    <a href="tel:+917020360561" class="contact-admin-btn">Contact Provider</a>
</div>

<div class="container" id="mainApp">

    <div id="customerLinkView" class="hidden customer-card">
        <div style="font-size: 40px; margin-bottom: 10px;">üêæ</div>
        <h2>Hello!</h2>
        <p style="color:#555; font-size:14px; margin-bottom:20px;">
            Here is the review for your pet's visit to Sukhada Hospital.
            <br>Click below to copy & post.
        </p>
        <textarea id="customerReviewText" class="review-preview-box" readonly style="display:block;"></textarea>
        <button class="copy-btn" style="display:block; margin-top:15px;" onclick="copyCustomerLinkReview()">üìã Copy & Open Google</button>
        <p style="font-size:11px; color:#999; margin-top:20px;">Wishing your pet good health! ‚ù§Ô∏è</p>
    </div>

    <div id="generatorApp">
        <h1>Sukhada 24x7 Multi Speciality Pet Hospital</h1>
        <div class="subtitle">Compassionate Care for Your Furry Friends</div>
        <div class="location">üìç Vaishali Nagar, Jaipur</div>
        
        <div style="text-align:center;">
            <a href="tel:+918003329626" class="phone-link">üìû Call Us Now</a>
        </div>

        <div id="ratingScreen" class="fade-in">
            <p>How was your experience?</p>
            <div class="star-container">
                <span class="star" onclick="rate(1)">‚òÖ</span>
                <span class="star" onclick="rate(2)">‚òÖ</span>
                <span class="star" onclick="rate(3)">‚òÖ</span>
                <span class="star" onclick="rate(4)">‚òÖ</span>
                <span class="star" onclick="rate(5)">‚òÖ</span>
            </div>
            <div class="experience-btns">
                <button class="exp-btn" id="btn-bad" onclick="selectExp('bad')">Issues üòû</button>
                <button class="exp-btn" id="btn-good" onclick="selectExp('good')">Great! üêæ</button>
            </div>
            <button class="action-btn" onclick="processRating()">Next Step ‚û°</button>
        </div>

        <div id="privateFeedbackScreen" class="hidden fade-in">
            <h2 style="color:#455A64;">We are sorry! üòî</h2>
            <p>Please tell us how we can improve.</p>
            <textarea id="privateFeedbackText" class="feedback-box" placeholder="Describe the issue..."></textarea>
            <button class="action-btn" style="background:#455A64;" onclick="submitPrivateFeedback()">Submit Feedback</button>
        </div>

        <div id="thankYouScreen" class="hidden fade-in">
            <div style="font-size: 50px; margin-bottom:10px;">‚úÖ</div>
            <h2 style="color:#455A64;">Thank You!</h2>
            <p>Your feedback has been submitted.</p>
        </div>

        <div id="aiToolScreen" class="hidden fade-in" style="text-align: left;">
            
            <div class="input-mode-tabs">
                <button class="mode-btn active-mode" id="btnModeVoice" onclick="switchMode('voice')">üé§ Speak</button>
                <button class="mode-btn" id="btnModeText" onclick="switchMode('text')">‚úçÔ∏è Write</button>
            </div>

            <div id="voiceSection" class="voice-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span style="font-size:11px; font-weight:bold; color:var(--primary);">SPEAK (Hindi/English):</span>
                    <select id="voiceLang" style="width:auto; padding:2px; font-size:11px; height:25px; margin:0;">
                        <option value="en-IN" selected>English</option>
                        <option value="hi-IN">Hindi</option>
                    </select>
                </div>
                <div class="voice-controls">
                    <button id="micBtn" class="mic-btn" onclick="startListening()">üé§</button>
                    <div style="flex:1;">
                        <p id="statusText" style="font-size:12px; color:#555; margin:0;">Tap mic & speak...<br>(Ex: "Doctor ne bahut ache se check kiya")</p>
                    </div>
                </div>
                <div id="spokenTextDisplay" style="display:none; margin-top:8px; font-size:12px; color:var(--primary); background:#fff; padding:6px; border-radius:4px;"></div>
            </div>

            <div id="textSection" class="text-section hidden">
                <label style="margin-top:0; color:var(--primary);">Describe Experience</label>
                <textarea id="manualInput" placeholder="Ex: Dr. was very polite..." style="height:80px; margin-bottom:0;"></textarea>
            </div>

            <label style="margin-top:0;">1. Select Location</label>
            <select id="locationSelect">
                <option value="Vaishali Nagar">Vaishali Nagar</option>
                <option value="Jaipur">Jaipur</option>
                <option value="Rajasthan">Rajasthan</option>
            </select>

            <div style="display: flex; gap: 10px;">
                <div style="flex:1;">
                    <label>2. Your Pet</label>
                    <select id="petSelect">
                        <option value="Dog">Dog üêï</option>
                        <option value="Cat">Cat üêà</option>
                        <option value="Rabbit">Rabbit üêá</option>
                        <option value="Turtle">Turtle üê¢</option>
                        <option value="Parrot">Parrot ü¶ú</option>
                        <option value="Goat">Goat üêê</option>
                        <option value="Exotic Pet">Exotic Pet ü¶é</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <label>3. Tone</label>
                    <select id="toneSelect">
                        <option value="Professional">Professional ü©∫</option>
                        <option value="Caring">Caring ‚ù§Ô∏è</option>
                        <option value="Short">Short üëå</option>
                        <option value="Grateful">Grateful üôè</option>
                    </select>
                </div>
            </div>

            <label>4. Reason for Visit (Optional)</label>
            <select id="treatmentSelect">
                <option value="">-- General Checkup --</option>
                <option value="flea and tick removal">Flea/Tick Removal</option>
                <option value="skin infection treatment">Skin Infection Treatment</option>
                <option value="dental cleaning">Dental Disease/Cleaning</option>
                <option value="broken teeth repair">Broken Teeth Repair</option>
                <option value="deworming">Deworming</option>
                <option value="kidney function test">Kidney Function Test</option>
                <option value="Rabies vaccination">Rabies Vaccination</option>
                <option value="respiratory issue treatment">Respiratory Issue</option>
                <option value="hair loss treatment">Hair Loss/Ringworm</option>
                <option value="emergency surgery">Emergency Surgery</option>
                <option value="allergy testing">Allergy Testing</option>
                <option value="first puppy visit">Puppy First Visit</option>
            </select>

            <div><button class="toggle-name" onclick="toggleNameField()">+ Add Your Name</button></div>
            <div id="nameArea" style="display:none; clear:both; margin-top:5px;">
                <input type="text" id="userName" placeholder="Your Name (Optional)">
            </div>

            <label style="clear:both;">5. Select Highlights (Pick 3-4)</label>

            <div id="keywordsWrapper">
                <div id="customCategory" class="hidden">
                    <div class="category-header">üÜï LATEST UPDATES (FROM ADMIN)</div>
                    <div class="keywords-container" id="customContainer"></div>
                </div>

                <div class="category-header">EMERGENCY & CRITICAL CARE</div>
                <div class="keywords-container">
                    <div class="keyword-chip" onclick="toggleKeyword(this, '24/7 emergency veterinary service')">üöë 24/7 Emergency</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet ambulance service')">üöê Pet Ambulance</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Critical care (ICU) for pets')">üè• Pet ICU</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Trauma and accident treatment for pets')">ü§ï Trauma/Accident</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet hospitalization service')">üõå Hospitalization</div>
                </div>

                <div class="category-header">SURGERY</div>
                <div class="keywords-container">
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Dog surgery services')">üêï Dog Surgery</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Soft tissue surgery for pets')">ü©∫ Soft Tissue Surgery</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Orthopedic surgery for dogs')">ü¶¥ Orthopedic Surgery</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet spay and neutering surgery')">‚úÇÔ∏è Spay/Neuter</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet wound management')">ü©π Wound Care</div>
                </div>

                <div class="category-header">DIAGNOSTICS & LAB</div>
                <div class="keywords-container">
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet X-ray service')">üì∏ X-Ray</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet ultrasound service')">üñ•Ô∏è Ultrasound</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet pathology lab testing')">üî¨ Pathology Lab</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet blood testing service')">ü©∏ Blood Test</div>
                </div>

                <div class="category-header">GENERAL CARE</div>
                <div class="keywords-container">
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Home visit veterinary service')">üè† Home Visit</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet dental treatment')">ü¶∑ Dental Care</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet vaccination service')">üíâ Vaccination</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Deworming and parasite control')">üêõ Deworming</div>
                    <div class="keyword-chip" onclick="toggleKeyword(this, 'Pet grooming and hygiene service')">üõÅ Grooming</div>
                </div>
            </div>

            <button class="action-btn" id="generateBtn" onclick="generateReview()">üöÄ Generate Review</button>

            <textarea id="reviewOutput" class="review-preview-box" readonly></textarea>
            
            <button class="copy-btn" id="copyBtn" onclick="copyToClipboard()">üìã Copy & Open Google</button>

            <div id="ownerPanel">
                <label style="color:var(--whatsapp); margin-top:0;">üì± Customer's WhatsApp Number</label>
                <div style="display:flex; gap:10px;">
                    <input type="tel" id="customerPhone" placeholder="Ex: 9876543210" style="margin-bottom:0;">
                    <button class="whatsapp-send-btn" style="width: auto; padding: 0 20px;" onclick="sendLinkToCustomer()">üöÄ Send</button>
                </div>
                <p style="font-size:11px; color:#555; margin-top:5px;">Customer will receive a direct link to post this review.</p>
            </div>

        </div>
    </div>

    <div class="footer">
        <img src="https://growft.odoo.com/web/image/1477-e0a28764/growft%20logo.webp" class="footer-logo" alt="Growft" loading="lazy">
        <div class="footer-text">
            Powered by <a href="https://growft.net" target="_blank">Growft</a>
        </div>
        <span class="owner-login-trigger" onclick="ownerLogin()">üîí Owner</span>
    </div>
</div>

<script>
    // --- ‚úÖ FIXED LINK (Correct CSV Format) ---
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQrWLyNviRTqBdRYgd0gJXyoOl16b8iBt9GZI4ijpUAcTAUN_tAuwVuc-Glg_4y6a-W9Dr9Hk4AT3qu/pub?gid=0&single=true&output=csv";

    // --- üîê SECURITY & CONFIGURATION ---
    const GOOGLE_REVIEW_LINK = "https://g.page/r/CQr2QAKYuPShEBM/review"; 
    const APP_STATUS = "active"; 
    const EXPIRY_DATE = "2026-12-31"; 

    // --- INITIALIZATION ---
    let isOwnerMode = false;
    let recognition; 

    window.onload = function() {
        // Security Check
        const today = new Date().toISOString().split('T')[0];
        if(APP_STATUS === "suspended" || today > EXPIRY_DATE) {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('lockScreen').style.display = 'flex';
            return;
        }

        // Fetch Keywords
        fetchKeywordsFromSheet();

        // URL Check
        const urlParams = new URLSearchParams(window.location.search);
        const reviewText = urlParams.get('review');
        if (reviewText) {
            document.getElementById('generatorApp').style.display = 'none';
            document.getElementById('customerLinkView').classList.remove('hidden');
            document.getElementById('customerReviewText').value = decodeURIComponent(reviewText);
        } else if(sessionStorage.getItem('isOwner') === 'true') {
            isOwnerMode = true;
        }
    };

    // --- FETCH DATA FUNCTION ---
    function fetchKeywordsFromSheet() {
        const cacheBuster = "&t=" + new Date().getTime(); 
        const finalURL = SHEET_CSV_URL + cacheBuster;

        console.log("Fetching from:", finalURL); 

        fetch(finalURL)
            .then(response => {
                if (!response.ok) throw new Error("Network response was not ok");
                return response.text();
            })
            .then(data => {
                if(data.trim().startsWith("<!DOCTYPE")) {
                    console.error("Error: Link is HTML, not CSV");
                    return;
                }

                const rows = data.split('\n');
                const customContainer = document.getElementById('customContainer');
                const customCategory = document.getElementById('customCategory');
                
                customContainer.innerHTML = '';
                let hasData = false;

                for(let i = 1; i < rows.length; i++) {
                    let keyword = rows[i].trim();
                    if(keyword.startsWith('"') && keyword.endsWith('"')) {
                        keyword = keyword.slice(1, -1);
                    }
                    keyword = keyword.replace(/,/g, '').trim();
                    
                    if(keyword) {
                        hasData = true;
                        createChipElement(keyword);
                    }
                }

                if(hasData) {
                    customCategory.classList.remove('hidden');
                }
            })
            .catch(error => console.error('Error fetching sheet:', error));
    }

    function createChipElement(text) {
        const container = document.getElementById('customContainer');
        const newChip = document.createElement('div');
        newChip.className = 'keyword-chip';
        newChip.innerText = "üÜï " + text;
        newChip.onclick = function() { toggleKeyword(this, text); };
        container.appendChild(newChip);
    }

    // --- OWNER & WHATSAPP LOGIC ---
    function ownerLogin() {
        if(isOwnerMode) { alert("Already logged in as Owner."); return; }
        const password = prompt("Enter Owner Password:");
        if(password === "admin123") { 
            isOwnerMode = true;
            sessionStorage.setItem('isOwner', 'true');
            alert("Owner Mode Active!");
        } else if(password) { alert("Incorrect Password"); }
    }

    function sendLinkToCustomer() {
        const phone = document.getElementById('customerPhone').value.replace(/\D/g, '');
        const review = document.getElementById('reviewOutput').value;
        if(phone.length < 10) { alert("Enter valid number"); return; }
        const finalPhone = phone.length === 10 ? "91" + phone : phone;
        const baseUrl = window.location.href.split('?')[0];
        const magicLink = `${baseUrl}?review=${encodeURIComponent(review)}`;
        const msg = `Namaste! üôè\n\nHere is the review for your pet's visit to Sukhada Hospital:\n\n*Tap this link to Post:*\n${magicLink}`;
        window.open(`https://wa.me/${finalPhone}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function copyCustomerLinkReview() {
        const box = document.getElementById("customerReviewText");
        box.select();
        document.execCommand('copy');
        window.open(GOOGLE_REVIEW_LINK, '_blank');
    }

    // --- APP LOGIC ---
    let selectedKeywords = [];
    let voiceText = "";
    let activeMode = 'voice';

    function switchMode(mode) {
        activeMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active-mode'));
        if(mode === 'voice') {
            document.getElementById('btnModeVoice').classList.add('active-mode');
            document.getElementById('voiceSection').classList.remove('hidden');
            document.getElementById('textSection').classList.add('hidden');
        } else {
            document.getElementById('btnModeText').classList.add('active-mode');
            document.getElementById('textSection').classList.remove('hidden');
            document.getElementById('voiceSection').classList.add('hidden');
        }
    }

    // Rating Logic
    let currentRating = 0;
    let currentExp = '';
    function rate(stars) {
        currentRating = stars;
        document.querySelectorAll('.star').forEach((star, index) => {
            star.classList.toggle('selected', index < stars);
        });
        if(stars >= 4) selectExp('good'); else selectExp('bad');
    }
    function selectExp(type) {
        currentExp = type;
        document.getElementById('btn-good').classList.remove('active');
        document.getElementById('btn-bad').classList.remove('bad-active');
        if (type === 'good') document.getElementById('btn-good').classList.add('active');
        else document.getElementById('btn-bad').classList.add('bad-active');
    }
    function processRating() {
        if (currentRating === 0 && currentExp === '') { alert("Please select a star rating."); return; }
        document.getElementById('ratingScreen').classList.add('hidden');
        let isHappy = (currentRating >= 4) || (currentExp === 'good');
        if (isHappy) document.getElementById('aiToolScreen').classList.remove('hidden');
        else document.getElementById('privateFeedbackScreen').classList.remove('hidden');
    }
    function submitPrivateFeedback() {
        document.getElementById('privateFeedbackScreen').classList.add('hidden');
        document.getElementById('thankYouScreen').classList.remove('hidden');
    }

    // Voice Logic
    function startListening() {
        if (!('webkitSpeechRecognition' in window)) { alert("Use Chrome Browser."); return; }
        recognition = new webkitSpeechRecognition();
        recognition.lang = document.getElementById('voiceLang').value;
        recognition.interimResults = false;
        document.getElementById('micBtn').classList.add('mic-active');
        document.getElementById('statusText').innerText = "Listening...";
        recognition.onresult = (event) => {
            voiceText = event.results[0][0].transcript;
            document.getElementById('spokenTextDisplay').style.display = 'block';
            document.getElementById('spokenTextDisplay').innerText = `Recorded: "${voiceText}"`;
        };
        recognition.onend = () => { document.getElementById('micBtn').classList.remove('mic-active'); document.getElementById('statusText').innerText = "Processing..."; };
        recognition.start();
    }

    async function generateReview() {
        const btn = document.getElementById('generateBtn');
        btn.innerText = "üîÑ Processing...";
        
        const userName = document.getElementById('userName').value.trim();
        const tone = document.getElementById('toneSelect').value;
        const location = document.getElementById('locationSelect').value;
        const petType = document.getElementById('petSelect').value;
        const treatment = document.getElementById('treatmentSelect').value;
        const manualText = document.getElementById('manualInput').value.trim();
        let rawInput = activeMode === 'voice' ? voiceText : manualText;

        if (selectedKeywords.length === 0 && !rawInput) {
            alert("Please select highlights or say something.");
            btn.innerText = "üöÄ Generate Review";
            return;
        }

        // Translation
        let finalBodyText = "";
        if (rawInput && rawInput.length > 1) {
            try {
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(rawInput)}&langpair=Autodetect|en`);
                const data = await res.json();
                let translated = data.responseData ? data.responseData.translatedText : "";
                if(!translated.includes("PLEASE SELECT")) finalBodyText = translated;
                else finalBodyText = rawInput;
            } catch(e) { finalBodyText = rawInput; }
        }

        // Generation
        let treatmentText = treatment ? treatment : "regular checkup";
        let intro = getRandom(reviewDB.intros[tone]);
        intro = intro.replace(/{location}/g, location).replace(/{pet}/g, petType.toLowerCase()).replace(/{treatment}/g, treatmentText);
        if (userName) intro = `I am ${userName}. ` + intro;

        let body = "";
        const shuffledKeywords = selectedKeywords.sort(() => Math.random() - 0.5);
        shuffledKeywords.forEach((k) => {
            if(reviewDB.keywords[k]) {
                let sentence = getRandom(reviewDB.keywords[k]);
                sentence = sentence.replace(/{location}/g, location).replace(/{pet}/g, petType.toLowerCase());
                body += sentence + " ";
            } else {
                const generics = [
                    `I was really impressed with the ${k}.`,
                    `The ${k} was excellent.`,
                    `Also, ${k} is worth mentioning.`,
                    `I happily recommend their ${k}.`
                ];
                body += getRandom(generics) + " ";
            }
        });

        if(finalBodyText) body += " " + finalBodyText + ". ";

        let outro = getRandom(reviewDB.outros[tone]);
        outro = outro.replace(/{location}/g, location).replace(/{pet}/g, petType.toLowerCase());

        const finalReview = intro + " " + body + outro;

        const box = document.getElementById('reviewOutput');
        box.value = finalReview;
        box.style.display = 'block';
        box.scrollIntoView({behavior: "smooth"});
        btn.innerText = "üöÄ Generate Review";

        if(isOwnerMode) {
            document.getElementById('ownerPanel').style.display = 'block';
            document.getElementById('copyBtn').style.display = 'none';
        } else {
            document.getElementById('ownerPanel').style.display = 'none';
            document.getElementById('copyBtn').style.display = 'block';
        }
    }

    function toggleKeyword(element, keyword) {
        element.classList.toggle('active');
        if (selectedKeywords.includes(keyword)) selectedKeywords = selectedKeywords.filter(k => k !== keyword);
        else selectedKeywords.push(keyword);
    }
    
    function toggleNameField() { 
        const field = document.getElementById('nameArea');
        field.style.display = field.style.display === 'block' ? 'none' : 'block';
    }

    function copyToClipboard() {
        const box = document.getElementById("reviewOutput");
        box.select();
        document.execCommand('copy');
        if(confirm("Review Copied! Open Google Maps?")) window.open(GOOGLE_REVIEW_LINK, '_blank');
    }
    
    function getRandom(arr) { if(!arr) return ""; return arr[Math.floor(Math.random() * arr.length)]; }

    // --- MASSIVE DATABASE (With New Categories) ---
    const reviewDB = {
        intros: {
            "Professional": [
                "I visited Sukhada Pet Hospital in {location} for my {pet}.",
                "Sukhada 24x7 Multi Speciality Pet Hospital provides excellent medical care in {location}.",
                "For reliable veterinary services in {location}, this is the best place.",
                "Professional and hygienic environment at this clinic in {location}.",
                "I highly recommend Dr. and the team at Sukhada Hospital, {location}.",
                "We had a very professional experience with our {pet} here.",
                "The medical facilities at this {location} hospital are top-notch.",
                "Impressed by the diagnosis for {treatment} provided in {location}.",
                "Standard of care is excellent at Sukhada Pet Hospital.",
                "If you need an expert vet in {location}, look no further.",
                "This clinic sets the benchmark for veterinary care in {location}.",
                "Extremely knowledgeable staff and doctors at Sukhada Hospital.",
                "The administrative and medical process here is seamless.",
                "Sukhada Hospital is the premier choice for pet care in {location}.",
                "I brought my {pet} for a checkup and was impressed by the professionalism.",
                "The expertise of the veterinarians here is commendable.",
                "Clean, organized, and professional service for my {pet}.",
                "Efficient handling of my {pet}'s case in {location}.",
                "Trusted veterinary advice given by the doctors here.",
                "The clinic follows high standards of hygiene and care."
            ],
            "Caring": [
                "The doctors here treated my {pet} with so much love! ‚ù§Ô∏è",
                "Best place for pets in {location}! They truly care.",
                "My {pet} was so comfortable with the doctor in {location}.",
                "Such a warm and welcoming clinic in {location}.",
                "They treated my little {pet} like their own family.",
                "Amazing experience! The staff is so kind and helpful.",
                "So happy to find such a caring pet hospital in {location}.",
                "My {pet} usually hates the vet, but was calm here!",
                "Lovely experience at Sukhada Hospital, {location}.",
                "Big thanks to the team for being so gentle with my {pet}.",
                "They handled my scared {pet} with so much patience.",
                "The love and care they show to animals is heartwarming.",
                "Felt like my {pet} was in safe hands immediately.",
                "The doctor took time to explain everything with kindness.",
                "Super friendly staff who love animals genuinely.",
                "My {pet} received lots of cuddles during the checkup!",
                "It's rare to find such compassionate vets in {location}.",
                "Thank you for being so sweet to my furry friend.",
                "The atmosphere here is full of positivity and care.",
                "My {pet} came back happy, which says it all!"
            ],
            "Short": [
                "Best pet hospital in {location}.",
                "Great service for my {pet}.",
                "Excellent veterinary clinic.",
                "Good doctor and staff.",
                "Recommended for all pet owners.",
                "Fast and good treatment.",
                "Very clean clinic in {location}.",
                "Best vet in town.",
                "Quality care for pets.",
                "Happy with the service.",
                "Quick and effective.",
                "Nice staff.",
                "Professional service.",
                "My go-to vet.",
                "5-star experience.",
                "Top notch clinic.",
                "Reasonable prices.",
                "Helpful doctor.",
                "Clean environment.",
                "Simply the best."
            ],
            "Grateful": [
                "I am so grateful to Sukhada Hospital for treating my {pet} in {location}.",
                "They were available 24x7 when my {pet} needed help with {treatment}.",
                "Thank you for the quick diagnosis and treatment.",
                "God bless the doctor for helping my {pet} recover.",
                "I don't know what I would have done without them in {location}.",
                "Heartfelt thanks to the entire team.",
                "Best emergency care for animals in {location}.",
                "Truly thankful for their support during a tough time.",
                "Thanks for guiding us properly regarding my {pet}'s health.",
                "A life-saver hospital in {location}.",
                "Words cannot express my gratitude for saving my {pet}.",
                "Thank you for answering my late-night calls.",
                "Grateful for the honest advice given by the doctor.",
                "They went above and beyond for my {pet}.",
                "Thanks for the successful surgery.",
                "We are forever thankful to the team.",
                "Thank you for giving my {pet} a second chance.",
                "Deeply appreciate the care provided in emergency.",
                "Thank you for treating us with so much respect.",
                "A blessing for pet owners in {location}."
            ]
        },
        keywords: {
            // NEW CATEGORY: EMERGENCY & CRITICAL
            "24/7 emergency veterinary service": [
                "Found the best 24/7 emergency veterinary service here.",
                "Life-saving 24/7 emergency veterinary service.",
                "Responsive 24/7 emergency veterinary service at night.",
                "They truly provide a dedicated 24/7 emergency veterinary service.",
                "Grateful for their reliable 24/7 emergency veterinary service."
            ],
            "Pet ambulance service": [
                "Their Pet ambulance service was a blessing.",
                "Quick response from the Pet ambulance service.",
                "The Pet ambulance service is well-equipped.",
                "Called their Pet ambulance service and they arrived fast.",
                "Safe transport via Pet ambulance service."
            ],
            "Critical care (ICU) for pets": [
                "The Critical care (ICU) for pets facilities are advanced.",
                "My pet survived thanks to their Critical care (ICU) for pets.",
                "Best Critical care (ICU) for pets in the city.",
                "Clean and monitored Critical care (ICU) for pets.",
                "High-standard Critical care (ICU) for pets."
            ],
            "Trauma and accident treatment for pets": [
                "Expert Trauma and accident treatment for pets.",
                "They handled the Trauma and accident treatment for pets professionally.",
                "Best place for Trauma and accident treatment for pets.",
                "Immediate Trauma and accident treatment for pets saved us.",
                "Skilled team for Trauma and accident treatment for pets."
            ],
            "Pet hospitalization service": [
                "The Pet hospitalization service is very hygienic.",
                "Comfortable Pet hospitalization service for recovery.",
                "Staff monitored my pet well during the Pet hospitalization service.",
                "Trustworthy Pet hospitalization service.",
                "Stress-free Pet hospitalization service."
            ],

            // NEW CATEGORY: SURGERY
            "Dog surgery services": [
                "Excellent Dog surgery services provided.",
                "Successful operation thanks to their Dog surgery services.",
                "Advanced equipment for Dog surgery services.",
                "The vet explained the Dog surgery services clearly.",
                "Recovered fast after using their Dog surgery services."
            ],
            "Soft tissue surgery for pets": [
                "Specialists in Soft tissue surgery for pets.",
                "Our pet underwent Soft tissue surgery for pets here.",
                "Complex Soft tissue surgery for pets handled well.",
                "Recommended for Soft tissue surgery for pets.",
                "Safe Soft tissue surgery for pets."
            ],
            "Orthopedic surgery for dogs": [
                "Best surgeon for Orthopedic surgery for dogs.",
                "My dog walks again thanks to Orthopedic surgery for dogs.",
                "Expert Orthopedic surgery for dogs available.",
                "Complex Orthopedic surgery for dogs done perfectly.",
                "Top-notch facility for Orthopedic surgery for dogs."
            ],
            "Pet spay and neutering surgery": [
                "Quick Pet spay and neutering surgery process.",
                "Affordable Pet spay and neutering surgery.",
                "Safe Pet spay and neutering surgery for my pet.",
                "The team made Pet spay and neutering surgery easy.",
                "Routine Pet spay and neutering surgery done well."
            ],
            "Pet wound management": [
                "Proper Pet wound management helped healing.",
                "Daily Pet wound management was excellent.",
                "Hygenic Pet wound management.",
                "Skilled staff for Pet wound management.",
                "Fast healing with their Pet wound management."
            ],

            // NEW CATEGORY: DIAGNOSTICS
            "Pet X-ray service": [
                "Digital Pet X-ray service is very clear.",
                "Quick Pet X-ray service on site.",
                "Instant results from Pet X-ray service.",
                "Affordable Pet X-ray service.",
                "Modern Pet X-ray service available."
            ],
            "Pet ultrasound service": [
                "Accurate Pet ultrasound service.",
                "The vet performed the Pet ultrasound service gently.",
                "Detailed report from Pet ultrasound service.",
                "High-tech Pet ultrasound service.",
                "Vital diagnosis via Pet ultrasound service."
            ],
            "Pet pathology lab testing": [
                "In-house Pet pathology lab testing is convenient.",
                "Fast results from Pet pathology lab testing.",
                "Reliable Pet pathology lab testing.",
                "Comprehensive Pet pathology lab testing.",
                "Trust their Pet pathology lab testing reports."
            ],
            "Pet blood testing service": [
                "Quick Pet blood testing service.",
                "Painless sample collection for Pet blood testing service.",
                "Accurate Pet blood testing service.",
                "Got the Pet blood testing service results in minutes.",
                "Essential Pet blood testing service available 24/7."
            ],

            // NEW CATEGORY: GENERAL & HOME
            "Home visit veterinary service": [
                "The Home visit veterinary service was so convenient.",
                "Dr. came home via their Home visit veterinary service.",
                "Best Home visit veterinary service in Jaipur.",
                "Timely Home visit veterinary service.",
                "Great Home visit veterinary service for elderly pets."
            ],
            "Deworming and parasite control": [
                "Regular Deworming and parasite control done here.",
                "Effective Deworming and parasite control plan.",
                "They guided us on Deworming and parasite control.",
                "Important Deworming and parasite control service.",
                "Keep pets healthy with their Deworming and parasite control."
            ],
            "Pet grooming and hygiene service": [
                "My pet looks great after the Pet grooming and hygiene service.",
                "Professional Pet grooming and hygiene service.",
                "Gentle Pet grooming and hygiene service.",
                "Hygienic Pet grooming and hygiene service.",
                "Loved the Pet grooming and hygiene service."
            ],
            "Pet dental treatment": [
                "The Pet dental treatment was very thorough.",
                "Solved bad breath with Pet dental treatment.",
                "Advanced Pet dental treatment equipment.",
                "My dog's teeth are clean thanks to Pet dental treatment.",
                "Recommended for Pet dental treatment."
            ],
            "Pet vaccination service": [
                "Timely Pet vaccination service reminders.",
                "Painless Pet vaccination service.",
                "Complete Pet vaccination service available.",
                "Affordable Pet vaccination service.",
                "Trust them for Pet vaccination service."
            ],

            // EXISTING KEYWORDS
            "Best Animal hospital": ["This is the best animal hospital in {location}.", "Hands down the best animal hospital.", "Sukhada stands out as the best animal hospital.", "If you want the best animal hospital experience, this is it."],
            "Best Veterinary clinic": ["Truly the best veterinary clinic I have visited.", "The most reliable best veterinary clinic."],
            "Best Vet clinic": ["A top-rated best vet clinic.", "Clean, efficient, and clearly the best vet clinic."],
            "Animal doctor": ["The animal doctor is very knowledgeable.", "Best animal doctor in {location}."],
            "Veterinary hospital": ["A fully equipped veterinary hospital.", "State-of-the-art veterinary hospital."],
            "Dog vaccination": ["Painless Dog vaccination.", "Best place for Dog vaccination."],
            "Pet insurance for dogs": ["They helped me with Pet insurance for dogs.", "Accepts Pet insurance for dogs."]
        },
        outros: {
            "Professional": [
                "I recommend them for all veterinary needs.",
                "A trustworthy medical center for animals.",
                "Will definitely continue our treatment here.",
                "The best choice for pet healthcare in {location}.",
                "Highly professional and recommended.",
                "Clean premises and knowledgeable staff.",
                "Satisfaction guaranteed with their service.",
                "One of the best clinics in Rajasthan.",
                "Do visit for quality pet care.",
                "Five stars for the professionalism.",
                "Efficient and effective treatment.",
                "A clinic that maintains high standards.",
                "Trust them with your pet's life.",
                "State-of-the-art facilities available.",
                "Best medical advice provided.",
                "Smooth experience from start to finish.",
                "Transparent pricing and good service.",
                "Highly qualified doctors.",
                "Excellent infrastructure.",
                "The go-to place for serious issues."
            ],
            "Caring": [
                "My {pet} is happy and healthy now! üêæ",
                "Will surely visit again for checkups.",
                "Thanks for making my {pet} feel safe.",
                "Best wishes to the amazing team.",
                "Love this place! ‚ù§Ô∏è",
                "Keep up the great work.",
                "Highly recommended to all pet parents.",
                "See you soon for the next vaccine.",
                "A happy place for pets.",
                "So glad we found you!",
                "Big hugs to the doctor.",
                "My pet actually likes coming here!",
                "Thanks for the treats and love.",
                "You guys are the best!",
                "Wonderful experience overall.",
                "Can't thank you enough.",
                "Feeling relieved and happy.",
                "Superb care for fur babies.",
                "Thanks for being so gentle.",
                "We love Sukhada Hospital!"
            ],
            "Short": [
                "Highly recommended.",
                "5 Stars.",
                "Best in {location}.",
                "Great job.",
                "Must visit.",
                "Good prices.",
                "Top quality.",
                "Very satisfied.",
                "Thank you.",
                "Superb service.",
                "Nice clinic.",
                "Good vet.",
                "Happy pet.",
                "Fast service.",
                "Clean place.",
                "Well done.",
                "Trusted vet.",
                "Recommended.",
                "Great care.",
                "Awesome."
            ],
            "Grateful": [
                "Thank you once again.",
                "Forever grateful for your help.",
                "I will always recommend Sukhada Hospital.",
                "Thanks for being there 24x7.",
                "Appreciate the emergency support.",
                "Thanks for saving us.",
                "Grateful for the reasonable rates too.",
                "You guys are angels for animals.",
                "Much appreciated.",
                "Thanks for the peace of mind.",
                "God bless the team.",
                "A heartfelt thank you.",
                "You saved my best friend.",
                "Can't thank you enough for the support.",
                "Thanks for the late night help.",
                "Respect for your dedication.",
                "Thank you for listening.",
                "Grateful for the kindness.",
                "Thanks for the quick recovery.",
                "Life savers."
            ]
        }
    };
</script>

</body>
</html>
