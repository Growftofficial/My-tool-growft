<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Feedback - Akanksha Opticals</title>
    <style>
        /* --- THEME: OPTICAL PROFESSIONAL (Royal Blue & Cyan) --- */
        :root {
            --primary: #1e3a8a; /* Royal Blue */
            --primary-light: #3b82f6;
            --accent: #06b6d4; /* Cyan/Teal */
            --bg-color: #f0f9ff;
            --card-bg: #ffffff;
            --gold: #fbbf24;
            --gray: #64748b;
            --whatsapp: #25D366;
            --danger: #ef4444; /* Red for Lock Screen */
        }

        /* --- RESET & BODY --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px 10px;
            min-height: 100vh; display: flex;
            justify-content: center; align-items: flex-start;
            color: #334155;
        }

        /* --- CONTAINER --- */
        .container {
            background: var(--card-bg); width: 100%; max-width: 500px;
            padding: 25px; border-radius: 16px;
            box-shadow: 0 10px 30px rgba(30, 58, 138, 0.15);
            border-top: 6px solid var(--primary); margin: auto;
            text-align: center;
            position: relative;
        }

        /* --- üîí LOCK SCREEN --- */
        #lockScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        .lock-icon { font-size: 60px; margin-bottom: 20px; color: var(--danger); }
        .lock-msg { font-size: 24px; font-weight: 800; color: #333; margin-bottom: 10px; }
        .contact-admin-btn {
            background: var(--primary); color: white; padding: 12px 25px;
            border-radius: 50px; text-decoration: none; font-weight: 600;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-top: 10px;
        }

        /* --- HEADER --- */
        h1 { color: var(--primary); margin: 5px 0 2px 0; font-size: 26px; font-weight: 800; }
        .location { color: var(--accent); font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; }
        
        p { color: #475569; font-size: 15px; margin-bottom: 20px; line-height: 1.5; }

        /* --- INPUTS & SELECTS --- */
        select, input, textarea {
            width: 100%; padding: 12px; border-radius: 8px;
            border: 1px solid #cbd5e1; background: #f8fafc;
            font-size: 15px; outline: none; margin-bottom: 10px;
            color: #334155; font-family: inherit;
        }
        select:focus, input:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.2); background: #fff; }
        label { 
            font-weight: 700; display: block; margin-top: 15px; margin-bottom: 8px; 
            color: #334155; font-size: 13px; text-transform: uppercase; text-align: left; 
        }

        /* --- STAR RATING --- */
        .star-container { display: flex; justify-content: center; gap: 8px; margin: 20px 0; direction: ltr; }
        .star { font-size: 42px; color: #e2e8f0; cursor: pointer; transition: transform 0.2s, color 0.2s; }
        .star.selected { color: var(--gold); }
        .star:hover { transform: scale(1.15); }

        /* --- BUTTONS --- */
        .experience-btns { display: flex; gap: 10px; margin-bottom: 25px; justify-content: center; }
        .exp-btn {
            padding: 12px 25px; border: 1px solid #cbd5e1; border-radius: 8px;
            background: #fff; cursor: pointer; font-weight: 600; color: #334155;
            flex: 1; max-width: 130px; transition: 0.2s;
        }
        .exp-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(30, 58, 138, 0.3); }
        .exp-btn.bad-active { background: #ef4444; color: white; border-color: #ef4444; box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3); }

        .action-btn {
            width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 10px; transition: 0.2s;
        }
        .action-btn:active { transform: scale(0.98); }

        /* --- INPUT MODES (Voice/Text) --- */
        .input-mode-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .mode-btn { 
            flex: 1; padding: 10px; border: 1px solid var(--primary); border-radius: 8px; 
            background: #fff; color: var(--primary); font-weight: 600; cursor: pointer; font-size: 13px;
        }
        .mode-btn.active-mode { background: var(--primary); color: white; }

        .voice-section, .text-section {
            background: #e0f2fe; padding: 12px; border-radius: 12px; 
            margin-bottom: 20px; border: 1px dashed var(--primary); text-align: left;
        }
        .voice-controls { display: flex; align-items: center; gap: 10px; }
        .mic-btn {
            width: 45px; height: 45px; border-radius: 50%;
            background: var(--primary); color: white; border: none;
            font-size: 20px; cursor: pointer; box-shadow: 0 4px 10px rgba(30, 58, 138, 0.3);
            display: flex; align-items: center; justify-content: center;
        }
        .mic-active { animation: pulse 1.5s infinite; background: var(--danger); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(30, 58, 138, 0.7); } 100% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } }

        /* --- CHIPS --- */
        .category-header { font-size: 11px; color: #94a3b8; margin: 15px 0 8px 0; font-weight: 700; letter-spacing: 0.5px; border-bottom: 1px dashed #e2e8f0; padding-bottom: 4px; text-align: left; }
        .keywords-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 5px; }
        .keyword-chip { 
            padding: 8px 12px; background-color: #fff; border-radius: 20px; 
            font-size: 12px; font-weight: 600; cursor: pointer; 
            border: 1px solid #bae6fd; color: var(--primary); 
            flex-grow: 1; text-align: center; transition: 0.2s;
        }
        .keyword-chip.active { background-color: var(--primary); color: white; border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 3px 8px rgba(30, 58, 138, 0.2); }

        .review-preview-box {
            width: 100%; min-height: 140px; margin-top: 20px; padding: 12px;
            border: 1px solid var(--primary); border-radius: 8px;
            background-color: #fff; color: #333; font-size: 14px;
            resize: none; outline: none;
        }

        .copy-btn { width: 100%; padding: 12px; background-color: #10b981; color: white; border: none; border-radius: 8px; margin-top: 15px; font-weight: 600; font-size: 15px; cursor: pointer; display: none; box-shadow: 0 4px 6px rgba(16, 185, 129, 0.25); }

        /* --- OWNER PANEL --- */
        #ownerPanel {
            display: none; margin-top: 20px; padding: 15px;
            border: 2px dashed var(--whatsapp); border-radius: 12px;
            background-color: #f0fdf4; text-align: left;
        }
        .whatsapp-send-btn {
            width: 100%; padding: 12px; background-color: var(--whatsapp);
            color: white; border: none; border-radius: 8px;
            font-size: 15px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 5px;
        }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .toggle-name { font-size: 13px; color: var(--primary); text-decoration: underline; cursor: pointer; float: right; margin-top: 5px; border: none; background: none; }

        /* --- FOOTER --- */
        .footer { margin-top: 35px; text-align: center; font-size: 12px; color: #64748b; border-top: 1px dashed #cbd5e1; padding-top: 15px; }
        .footer-logo { display: block; margin: 0 auto 5px auto; max-height: 28px; width: auto; opacity: 0.85; }
        .footer a { color: var(--primary); text-decoration: none; font-weight: 700; }
        .owner-login-trigger { font-size: 11px; color: #ccc; cursor: pointer; text-decoration: none; position: absolute; bottom: 5px; right: 10px; }

        /* CUSTOMER VIEW */
        .customer-card { text-align: center; padding: 20px; }
        .customer-card h2 { color: var(--primary); }
    </style>
</head>
<body>

<div id="lockScreen" style="display: none;">
    <div class="lock-icon">üîí</div>
    <div class="lock-msg">Service Suspended</div>
    <div style="font-size:14px; color:#666; margin-bottom:20px;">
        This review tool is currently inactive.<br>Please contact the administrator.
    </div>
    <a href="tel:+917020370561" class="contact-admin-btn">Contact Support</a>
</div>

<div class="container" id="mainApp">

    <div id="customerLinkView" class="hidden customer-card">
        <div style="font-size: 40px; margin-bottom: 10px;">üëì</div>
        <h2>Hello!</h2>
        <p style="color:#555; font-size:14px; margin-bottom:20px;">
            Here is the review for your recent visit to Akanksha Opticals.
            <br>Click below to copy & post.
        </p>
        <textarea id="customerReviewText" class="review-preview-box" readonly></textarea>
        <button class="copy-btn" style="display:block; margin-top:15px;" onclick="copyCustomerLinkReview()">üìã Copy & Open Google</button>
        <p style="font-size:11px; color:#999; margin-top:20px;">Thank you for trusting us for your vision! üëÅÔ∏è</p>
    </div>

    <div id="generatorApp">
        <h1>Akanksha Opticals</h1>
        <div class="location">üìç Wagholi, Pune</div>

        <div id="ratingScreen" class="fade-in">
            <p>How was your experience at our store?</p>

            <div class="star-container">
                <span class="star" onclick="rate(1)">‚òÖ</span>
                <span class="star" onclick="rate(2)">‚òÖ</span>
                <span class="star" onclick="rate(3)">‚òÖ</span>
                <span class="star" onclick="rate(4)">‚òÖ</span>
                <span class="star" onclick="rate(5)">‚òÖ</span>
            </div>

            <div class="experience-btns">
                <button class="exp-btn" id="btn-bad" onclick="selectExp('bad')">Not Good üòû</button>
                <button class="exp-btn" id="btn-good" onclick="selectExp('good')">Excellent üëì</button>
            </div>

            <button class="action-btn" onclick="processRating()">Next Step ‚û°</button>
        </div>

        <div id="privateFeedbackScreen" class="hidden fade-in">
            <h2 style="color:#334155;">We are sorry! üòî</h2>
            <p>Please tell us how we can improve. Your feedback will be sent directly to the owner.</p>
            <textarea id="privateFeedbackText" placeholder="Write your issues here..."></textarea>
            <button class="action-btn" style="background:#475569;" onclick="submitPrivateFeedback()">Submit Feedback</button>
        </div>

        <div id="thankYouScreen" class="hidden fade-in">
            <div style="font-size: 50px; margin-bottom:10px;">‚úÖ</div>
            <h2 style="color:#334155;">Thank You!</h2>
            <p>Your feedback has been submitted successfully.</p>
        </div>

        <div id="aiToolScreen" class="hidden fade-in" style="text-align: left;">
            <p style="text-align:center; font-weight:bold; color:var(--primary); margin-bottom: 20px;">‚ú® Create your review in 1 click!</p>
            
            <div class="input-mode-tabs">
                <button class="mode-btn active-mode" id="btnModeVoice" onclick="switchMode('voice')">üé§ Speak</button>
                <button class="mode-btn" id="btnModeText" onclick="switchMode('text')">‚úçÔ∏è Write</button>
            </div>

            <div id="voiceSection" class="voice-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span style="font-size:11px; font-weight:bold; color:var(--primary);">SPEAK (Hindi/English):</span>
                    <select id="voiceLang" style="width:auto; padding:2px; font-size:11px; height:25px; margin:0;">
                        <option value="en-IN" selected>English</option>
                        <option value="hi-IN">Hindi</option>
                        <option value="mr-IN">Marathi</option>
                    </select>
                </div>
                <div class="voice-controls">
                    <button id="micBtn" class="mic-btn" onclick="startListening()">üé§</button>
                    <div style="flex:1;">
                        <p id="statusText" style="font-size:12px; color:#555; margin:0;">Tap mic & speak...<br>(Ex: "Chashme ki quality bahut achi hai")</p>
                    </div>
                </div>
                <div id="spokenTextDisplay" style="display:none; margin-top:8px; font-size:12px; color:var(--primary); background:#fff; padding:6px; border-radius:4px;"></div>
            </div>

            <div id="textSection" class="text-section hidden">
                <label style="margin-top:0; color:var(--primary);">Describe Experience</label>
                <textarea id="manualInput" placeholder="Ex: Amazing collection of frames..." style="height:80px; margin-bottom:0;"></textarea>
            </div>

            <div style="display: flex; gap: 10px;">
                <div style="flex:1;">
                    <label style="margin-top:0;">Location</label>
                    <select id="locationSelect">
                        <option value="Wagholi">Wagholi</option>
                        <option value="Kharadi">Kharadi</option>
                        <option value="Pune">Pune</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <label style="margin-top:0;">Review Tone</label>
                    <select id="toneSelect">
                        <option value="Professional">Professional üëî</option>
                        <option value="Friendly">Friendly üòÉ</option>
                        <option value="Short">Short & Sweet üëå</option>
                        <option value="Grateful">Grateful üôè</option>
                    </select>
                </div>
            </div>

            <div><button class="toggle-name" onclick="toggleNameField()">+ Add Your Name</button></div>
            <div id="nameArea" style="display:none; clear:both; margin-top:5px;">
                <input type="text" id="userName" placeholder="Your Name (Optional)">
            </div>

            <label style="clear:both;">Select what you liked (Pick 3-4)</label>

            <div class="category-header">SERVICE & STAFF</div>
            <div class="keywords-container">
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Best Store')">üèÜ Best Optical Store</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Best Optician')">üë®‚Äç‚öïÔ∏è Best Optician</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Staff')">ü§ù Professional Staff</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Fast Service')">‚ö° Fastest Service</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Rated')">‚≠ê Best Rated Shop</div>
            </div>

            <div class="category-header">GLASSES & LENSES</div>
            <div class="keywords-container">
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Collection')">üëì Nice Collection</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Designer')">üï∂Ô∏è Designer Frames</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Affordable')">üí∞ Affordable Price</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Blue Cut')">üíª Blue Cut Lenses</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Contact Lens')">üëÅÔ∏è Contact Lens</div>
            </div>

            <div class="category-header">TECHNICAL SERVICES</div>
            <div class="keywords-container">
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Eye Test')">üñ•Ô∏è Computer Eye Test</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Repair')">üîß Spectacle Repair</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Alignment')">üìè Frame Alignment</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Replacement')">üîÑ Lens Replacement</div>
            </div>

            <button class="action-btn" onclick="generateReview()">üöÄ Generate Review</button>

            <textarea id="reviewOutput" class="review-preview-box" style="display:none;" readonly></textarea>
            
            <button class="copy-btn" id="copyBtn" onclick="copyToClipboard()">üìã Copy & Open Google</button>

            <div id="ownerPanel">
                <label style="color:var(--whatsapp); margin-top:0;">üì± Customer's WhatsApp Number</label>
                <div style="display:flex; flex-direction:column; gap:10px;">
                    <input type="tel" id="customerPhone" placeholder="Ex: 9876543210" style="margin-bottom:0;">
                    <button class="whatsapp-send-btn" onclick="sendLinkToCustomer()">üöÄ Send to Customer</button>
                </div>
                <p style="font-size:11px; color:#555; margin-top:5px;">Customer will receive a direct link to post this review.</p>
            </div>

        </div>
    </div>

    <div class="footer">
        <img src="https://growft.odoo.com/web/image/1477-e0a28764/growft%20logo.webp" class="footer-logo" alt="Growft">
        <div class="footer-text">
            Built by <a href="https://growft.net" target="_blank">Growft</a><br>
            Contact to build your Agent: <a href="tel:+917020370561">7020370561</a>
        </div>
        <span class="owner-login-trigger" onclick="ownerLogin()">üîí Owner</span>
    </div>
</div>

<script>
    // --- üîê SECURITY & CONFIGURATION ---
    const GOOGLE_REVIEW_LINK = "https://g.page/r/CQWvJDQmDKBNEBM/review"; 
    
    // CHANGE TO "suspended" TO LOCK THE TOOL
    const APP_STATUS = "active"; 
    
    // EXPIRY DATE (YYYY-MM-DD)
    const EXPIRY_DATE = "2026-12-31"; 

    // --- INITIALIZATION ---
    let isOwnerMode = false;

    window.onload = function() {
        // Security Check
        const today = new Date().toISOString().split('T')[0];
        if(APP_STATUS === "suspended" || today > EXPIRY_DATE) {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('lockScreen').style.display = 'flex';
            return;
        }

        // URL Check (Customer Mode)
        const urlParams = new URLSearchParams(window.location.search);
        const reviewText = urlParams.get('review');
        if (reviewText) {
            document.getElementById('generatorApp').style.display = 'none';
            document.getElementById('customerLinkView').classList.remove('hidden');
            document.getElementById('customerReviewText').value = decodeURIComponent(reviewText);
        } else if(sessionStorage.getItem('isOwner') === 'true') {
            isOwnerMode = true;
        }
    };

    // --- OWNER & WHATSAPP LOGIC ---
    function ownerLogin() {
        if(isOwnerMode) { alert("Already logged in as Owner."); return; }
        const password = prompt("Enter Owner Password:");
        if(password === "admin123") { // CHANGE PASSWORD HERE
            isOwnerMode = true;
            sessionStorage.setItem('isOwner', 'true');
            alert("Owner Mode Active!");
        } else if(password) { alert("Incorrect Password"); }
    }

    function sendLinkToCustomer() {
        const phone = document.getElementById('customerPhone').value.replace(/\D/g, '');
        const review = document.getElementById('reviewOutput').value;
        if(phone.length < 10) { alert("Enter valid number"); return; }
        const finalPhone = phone.length === 10 ? "91" + phone : phone;
        const baseUrl = window.location.href.split('?')[0];
        const magicLink = `${baseUrl}?review=${encodeURIComponent(review)}`;
        const msg = `Namaste! üôè\n\nHere is the review for your visit to Akanksha Opticals:\n\n*Tap this link to Post:*\n${magicLink}`;
        window.open(`https://wa.me/${finalPhone}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function copyCustomerLinkReview() {
        const box = document.getElementById("customerReviewText");
        box.select();
        document.execCommand('copy');
        window.open(GOOGLE_REVIEW_LINK, '_blank');
    }

    // --- APP LOGIC ---
    let selectedKeywords = [];
    let voiceText = "";
    let activeMode = 'voice';

    function switchMode(mode) {
        activeMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active-mode'));
        if(mode === 'voice') {
            document.getElementById('btnModeVoice').classList.add('active-mode');
            document.getElementById('voiceSection').classList.remove('hidden');
            document.getElementById('textSection').classList.add('hidden');
        } else {
            document.getElementById('btnModeText').classList.add('active-mode');
            document.getElementById('textSection').classList.remove('hidden');
            document.getElementById('voiceSection').classList.add('hidden');
        }
    }

    let currentRating = 0;
    let currentExp = '';

    function rate(stars) {
        currentRating = stars;
        let allStars = document.querySelectorAll('.star');
        allStars.forEach((star, index) => {
            star.classList.toggle('selected', index < stars);
        });
        if(stars >= 4) selectExp('good');
        else selectExp('bad');
    }

    function selectExp(type) {
        currentExp = type;
        document.getElementById('btn-good').classList.remove('active');
        document.getElementById('btn-bad').classList.remove('bad-active');
        if (type === 'good') document.getElementById('btn-good').classList.add('active');
        else document.getElementById('btn-bad').classList.add('bad-active');
    }

    function processRating() {
        if (currentRating === 0 && currentExp === '') { alert("Please select a star rating."); return; }
        document.getElementById('ratingScreen').classList.add('hidden');
        let isHappy = (currentRating >= 4) || (currentExp === 'good');
        if (isHappy) document.getElementById('aiToolScreen').style.display = 'block';
        else document.getElementById('privateFeedbackScreen').classList.remove('hidden');
    }

    function submitPrivateFeedback() {
        if(document.getElementById('privateFeedbackText').value.trim() === "") { alert("Please write a few words."); return; }
        document.getElementById('privateFeedbackScreen').classList.add('hidden');
        document.getElementById('thankYouScreen').classList.remove('hidden');
    }

    // Voice Input Logic
    function startListening() {
        if (!('webkitSpeechRecognition' in window)) { alert("Use Chrome Browser."); return; }
        recognition = new webkitSpeechRecognition();
        recognition.lang = document.getElementById('voiceLang').value;
        recognition.interimResults = false;
        document.getElementById('micBtn').classList.add('mic-active');
        document.getElementById('statusText').innerText = "Listening...";
        recognition.onresult = (event) => {
            voiceText = event.results[0][0].transcript;
            document.getElementById('spokenTextDisplay').style.display = 'block';
            document.getElementById('spokenTextDisplay').innerText = `Recorded: "${voiceText}"`;
        };
        recognition.onend = () => { document.getElementById('micBtn').classList.remove('mic-active'); document.getElementById('statusText').innerText = "Processing..."; };
        recognition.start();
    }

    // PRESERVED DATASETS
    const reviewDB = {
        intros: {
            "Professional": ["I recently visited Akanksha Opticals in {location}.", "I was looking for a reputable optical store in {location} and chose this one.", "Highly professional experience at Akanksha Opticals, {location}.", "My visit to Akanksha Opticals in {location} was excellent.", "If you need quality eyewear in {location}, this is the place.", "The service standards at this {location} store are top-notch.", "I am very impressed with the management at Akanksha Opticals.", "A truly premium optical experience in {location}.", "I highly recommend this store for its professional approach.", "Best place for a comprehensive eye checkup in {location}."],
            "Friendly": ["Had such a great time at Akanksha Opticals {location}! üòÉ", "Visited the store in {location} and loved the vibe!", "The staff at Akanksha Opticals {location} is just amazing.", "Super happy with my new glasses from their {location} shop.", "Best experience ever at an optical shop in {location}!", "Feeling great with my new specs from Akanksha Opticals.", "Everyone here is so helpful and kind.", "Love this place in {location} for all eyewear needs.", "They treat you like family here.", "Such a welcoming atmosphere at the {location} branch."],
            "Short": ["Visited Akanksha Opticals in {location}.", "Best optical shop in {location}.", "Good experience at the {location} store.", "Nice service in {location}.", "Bought glasses from here.", "Very good opticals in {location}.", "Recommended store in {location}.", "Fast service at Akanksha Opticals.", "Great quality products.", "Five stars for the team."],
            "Grateful": ["I am so thankful to the team at Akanksha Opticals {location}.", "They really saved me by fixing my glasses quickly in {location}.", "Big thanks to the staff for helping me choose.", "I appreciate the honest advice given by the optician in {location}.", "Thank you Akanksha Opticals for the wonderful service.", "Grateful for the urgent service provided.", "Thanks for the perfect eye test and guidance.", "So happy I found this store in {location}.", "They went above and beyond to help me.", "Heartfelt thanks for the quick delivery."]
        },
        outros: {
            "Professional": ["I highly recommend them for their quality and service.", "A reliable choice for everyone in {location}.", "They maintain high standards of hygiene and service.", "Will continue to visit them for all optical needs.", "Truly the best in the business in {location}.", "Excellent value for money and professional care.", "5-star rating for their efficiency.", "Do visit for a professional eye consultation.", "Satisfied with the overall procedure.", "Wishing the business continued success."],
            "Friendly": ["Will definitely come back again! üëç", "Don't go anywhere else in {location}, just come here!", "Loving my new look! üòé", "Cheers to the team!", "You guys are the best in {location}.", "Super satisfied customer here.", "Will tell all my friends to visit.", "Thanks again guys!", "Keep shining!", "See you soon for my next pair."],
            "Short": ["Recommended.", "Good job.", "5 Stars.", "Must visit.", "Great shop.", "Value for money.", "Best in {location}.", "Nice work.", "Happy customer.", "Thank you."],
            "Grateful": ["Thank you once again for the support.", "God bless the team.", "Really appreciate the help.", "Thanks for being so kind.", "I will always be a loyal customer.", "Thanks for making it easy for me.", "Deeply appreciate the quick turnaround.", "Thank you for the discount and service.", "So glad I visited.", "Thanks for the clear vision!"]
        },
        keywords: {
            "Best Store": ["Hands down the best optical store in {location}.", "Easily the finest shop for eyewear in the area.", "No other store matches their quality service.", "This is the best optical shop I've found nearby."],
            "Best Optician": ["The optician is very experienced and skilled.", "Best optician I have consulted so far.", "He explains everything about eye health clearly.", "Very patient and accurate optician."],
            "Staff": ["The staff is extremely professional and polite.", "Loved how the staff helped me choose the frame.", "Very courteous staff members.", "The team is efficient and friendly."],
            "Fast Service": ["I was amazed by their fastest service delivery.", "Got my glasses within hours, super fast service.", "They value time and provide quick service.", "Delivery was prompt and on time."],
            "Rated": ["Now I know why it is the best rated optical shop.", "Truly deserves the 5-star rating.", "Top rated for a reason - quality and trust.", "Living up to its reputation as a top rated shop."],
            "Collection": ["They have a very nice collection of frames.", "Huge variety of frames to choose from.", "Loved the unique collection they keep.", "Styles for every face shape in their collection."],
            "Designer": ["Bought a pair of designer frames and I love them.", "Great range of premium designer brands.", "If you want stylish designer glasses, go here.", "Modern and designer frames at good rates."],
            "Affordable": ["The prices are very affordable compared to others.", "Got high quality glasses at an affordable price.", "Budget-friendly options without compromising quality.", "Affordable glasses for the whole family."],
            "Blue Cut": ["The blue cut lenses have reduced my eye strain.", "Highly recommend their blue light glasses for computer users.", "Blue cut lenses quality is premium.", "My eyes feel much better with these blue cut glasses."],
            "Contact Lens": ["Got the best deal on contact lenses.", "They are a reliable contact lens dealer.", "Guided me on how to use contact lenses properly.", "Fresh stock of contact lenses available."],
            "Eye Test": ["The computerized eye testing was very precise.", "State of the art equipment for eye testing.", "Eye checkup was thorough and accurate.", "Free computerized eye testing facility is great."],
            "Repair": ["They fixed my broken frame in minutes.", "Best spectacle repair shop in {location}.", "Did a great job with screw tightening.", "Saved my old glasses with quick repair."],
            "Alignment": ["Frame alignment was done perfectly.", "Adjusted my glasses for a perfect fit.", "Screw tightening and alignment service is good.", "My glasses fit perfectly now after alignment."],
            "Replacement": ["Lens replacement service was quick and easy.", "Replaced my old scratched lenses with new ones.", "Fitted new lenses in my old frame perfectly.", "Cost-effective lens replacement service."]
        }
    };

    async function generateReview() {
        const btn = document.querySelector('.action-btn');
        const originalText = btn.innerText;
        btn.innerText = "üîÑ Processing...";
        
        const userName = document.getElementById('userName').value.trim();
        const tone = document.getElementById('toneSelect').value;
        const location = document.getElementById('locationSelect').value;
        const manualText = document.getElementById('manualInput').value.trim();
        const outputBox = document.getElementById('reviewOutput');
        const copyBtn = document.getElementById('copyBtn');

        let rawInput = activeMode === 'voice' ? voiceText : manualText;

        if (selectedKeywords.length === 0 && !rawInput) {
            alert("Please select at least 2 highlights or say something.");
            btn.innerText = originalText;
            return;
        }

        // Translation Logic
        let finalBodyText = "";
        if (rawInput && rawInput.length > 1) {
            try {
                const srcLangCode = document.getElementById('voiceLang').value.split('-')[0];
                let langPair = 'Autodetect|en';
                if(srcLangCode === 'hi') langPair = 'hi|en';
                if(srcLangCode === 'mr') langPair = 'mr|en';
                
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(rawInput)}&langpair=${langPair}`);
                const data = await res.json();
                let translated = data.responseData ? data.responseData.translatedText : "";
                if(!translated.includes("PLEASE SELECT")) finalBodyText = translated;
                else finalBodyText = rawInput;
            } catch(e) { finalBodyText = rawInput; }
        }

        // Review Assembly
        outputBox.style.display = 'block';
        outputBox.style.opacity = "0.5";

        let intro = getRandomItem(reviewDB.intros[tone]).replace(/{location}/g, location);
        if (userName) intro = `I am ${userName}. ` + intro;

        let body = "";
        const shuffledKeywords = selectedKeywords.sort(() => Math.random() - 0.5);
        shuffledKeywords.forEach((k) => {
            if(reviewDB.keywords[k]) {
                let sentence = getRandomItem(reviewDB.keywords[k]).replace(/{location}/g, location);
                body += sentence + " ";
            }
        });

        if(finalBodyText) body += finalBodyText + " ";

        let outro = getRandomItem(reviewDB.outros[tone]).replace(/{location}/g, location);

        const finalReview = intro + " " + body + outro;

        setTimeout(() => {
            outputBox.style.opacity = "1";
            outputBox.value = finalReview;
            copyBtn.style.display = "block";
            btn.innerText = originalText;
            
            if(isOwnerMode) {
                document.getElementById('ownerPanel').style.display = 'block';
                document.getElementById('copyBtn').style.display = 'none';
            } else {
                document.getElementById('ownerPanel').style.display = 'none';
                document.getElementById('copyBtn').style.display = 'block';
            }
            
            if (window.innerWidth < 600) outputBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 500);
    }

    function toggleNameField() { 
        const field = document.getElementById('nameArea');
        field.style.display = field.style.display === 'block' ? 'none' : 'block';
    }

    function toggleKeyword(element, keyword) {
        element.classList.toggle('active');
        if (selectedKeywords.includes(keyword)) selectedKeywords = selectedKeywords.filter(item => item !== keyword);
        else selectedKeywords.push(keyword);
    }
    
    function copyToClipboard() {
        const copyText = document.getElementById("reviewOutput");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(() => {
            const isConfirmed = confirm("Review Copied! üëì\n\nClick OK to open Google Maps.");
            if(isConfirmed) window.open(GOOGLE_REVIEW_LINK, '_blank');
        });
    }
    
    function getRandomItem(arr) { if(!arr) return ""; return arr[Math.floor(Math.random() * arr.length)]; }
</script>

</body>
</html>
