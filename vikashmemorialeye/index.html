<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Feedback - Vikash Memorial Eye Hospital</title>
    <style>
        /* --- THEME COLORS --- */
        :root {
            --primary: #0284c7;
            --primary-dark: #0369a1;
            --bg-color: #f0f9ff;
            --card-bg: #ffffff;
            --text-main: #334155;
            --gold: #fbbf24;
            --gray: #64748b;
            --red: #ef4444;
            --green: #22c55e;
            --whatsapp: #25D366;
            --danger: #ef4444;
        }

        /* --- RESET --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px 10px;
            min-height: 100vh; display: flex;
            justify-content: center; align-items: flex-start;
            color: var(--text-main);
        }

        /* --- CONTAINER --- */
        .container {
            background: var(--card-bg); width: 100%; max-width: 500px;
            padding: 25px; border-radius: 16px;
            box-shadow: 0 10px 30px rgba(2, 132, 199, 0.15);
            border-top: 6px solid var(--primary); margin: auto;
            text-align: center;
            position: relative;
        }

        /* --- üîí LOCK SCREEN --- */
        #lockScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        .lock-icon { font-size: 60px; margin-bottom: 20px; animation: float 3s ease-in-out infinite; color: var(--danger); }
        .lock-title { color: var(--danger); font-size: 24px; font-weight: 800; margin-bottom: 10px; }
        .lock-msg { color: var(--gray); font-size: 16px; margin-bottom: 25px; line-height: 1.5; }
        .contact-admin-btn {
            background: var(--primary); color: white; padding: 12px 25px;
            border-radius: 50px; text-decoration: none; font-weight: 700;
            box-shadow: 0 4px 10px rgba(2, 132, 199, 0.3);
        }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }

        /* --- HEADER --- */
        h1 { color: var(--primary-dark); margin: 5px 0 2px 0; font-size: 24px; font-weight: 800; }
        .location { color: var(--gray); font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        
        .phone-link {
            text-decoration: none; color: #fff; background: var(--primary);
            padding: 8px 18px; border-radius: 20px; display: inline-block;
            font-size: 14px; font-weight: 700; transition: 0.2s;
            box-shadow: 0 4px 6px rgba(2, 132, 199, 0.2); margin-bottom: 20px;
        }

        /* --- INPUTS --- */
        select, input, textarea {
            width: 100%; padding: 12px; border-radius: 8px;
            border: 1px solid #bae6fd; background: #f0f9ff;
            font-size: 14px; outline: none; margin-bottom: 10px;
            color: var(--text-main); font-family: inherit;
        }
        select:focus, input:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.1); background: #fff; }
        label { font-weight: 700; display: block; margin-top: 12px; margin-bottom: 6px; color: var(--primary-dark); font-size: 12px; text-transform: uppercase; text-align: left; }

        /* --- RATING --- */
        .star-container { display: flex; justify-content: center; gap: 8px; margin: 20px 0; direction: ltr; }
        .star { font-size: 42px; color: #cbd5e1; cursor: pointer; transition: transform 0.2s, color 0.2s; }
        .star.selected { color: var(--gold); }

        .experience-btns { display: flex; gap: 10px; margin-bottom: 25px; justify-content: center; }
        .exp-btn {
            padding: 12px 15px; border: 1px solid #bae6fd; border-radius: 8px;
            background: #fff; cursor: pointer; font-weight: 600; color: var(--text-main);
            flex: 1; transition: 0.2s; font-size: 14px;
        }
        .exp-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(2, 132, 199, 0.3); }
        .exp-btn.bad-active { background: #ef4444; color: white; border-color: #ef4444; box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3); }

        .action-btn {
            width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 16px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 10px;
        }

        /* --- INPUT MODES --- */
        .input-mode-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .mode-btn { 
            flex: 1; padding: 10px; border: 1px solid var(--primary); border-radius: 8px; 
            background: #fff; color: var(--primary); font-weight: 600; cursor: pointer; font-size: 13px;
        }
        .mode-btn.active-mode { background: var(--primary); color: white; }

        .voice-section, .text-section {
            background: #e0f2fe; padding: 12px; border-radius: 12px; 
            margin-bottom: 20px; border: 1px dashed var(--primary); text-align: left;
        }
        .voice-controls { display: flex; align-items: center; gap: 10px; }
        .mic-btn {
            width: 45px; height: 45px; border-radius: 50%;
            background: var(--primary); color: white; border: none;
            font-size: 20px; cursor: pointer; box-shadow: 0 4px 10px rgba(2, 132, 199, 0.3);
            display: flex; align-items: center; justify-content: center;
        }
        .mic-active { animation: pulse 1.5s infinite; background: var(--danger); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(2, 132, 199, 0.7); } 100% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } }

        /* --- CHIPS --- */
        .keywords-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .keyword-chip { 
            padding: 8px 12px; background-color: #fff; border-radius: 20px; 
            font-size: 12px; font-weight: 600; cursor: pointer; 
            border: 1px solid #bae6fd; color: var(--primary); 
            flex-grow: 1; text-align: center; transition: 0.2s;
        }
        .keyword-chip.active { background-color: var(--primary); color: white; border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 3px 6px rgba(2, 132, 199, 0.2); }
        .cat-title { width:100%; font-size: 11px; font-weight: 700; color: var(--gray); margin-top: 10px; border-bottom: 1px dashed #cbd5e1; padding-bottom: 3px; text-transform: uppercase; letter-spacing: 0.5px; text-align: left; }

        .review-preview-box {
            width: 100%; min-height: 140px; margin-top: 15px; border-radius: 8px; padding: 12px; 
            border: 1px solid var(--primary); display: none; background: #fff; resize: none; outline: none; font-size: 14px;
        }

        .copy-btn { width: 100%; padding: 12px; background-color: var(--green); color: white; border: none; border-radius: 8px; margin-top: 15px; font-weight: 600; font-size: 15px; cursor: pointer; display: none; box-shadow: 0 4px 6px rgba(5, 150, 105, 0.2); }

        /* --- OWNER PANEL --- */
        #ownerPanel {
            display: none; margin-top: 20px; padding: 15px;
            border: 2px dashed var(--whatsapp); border-radius: 12px;
            background-color: #f0fdf4; text-align: left;
        }
        .whatsapp-send-btn {
            width: 100%; padding: 12px; background-color: var(--whatsapp);
            color: white; border: none; border-radius: 8px;
            font-size: 15px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* --- UTILS --- */
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none !important; }
        .or-divider { text-align: center; font-size: 12px; color: var(--gray); margin: 20px 0; position: relative; }
        .or-divider:before { content: ""; position: absolute; left: 0; top: 50%; width: 45%; height: 1px; background: #cbd5e1; }
        .or-divider:after { content: ""; position: absolute; right: 0; top: 50%; width: 45%; height: 1px; background: #cbd5e1; }
        .toggle-name { font-size: 13px; color: var(--primary); text-decoration: underline; cursor: pointer; float: right; margin-top: 5px; border: none; background: none; }

        /* --- FOOTER --- */
        .footer { margin-top: 35px; text-align: center; font-size: 12px; color: #94a3b8; border-top: 1px dashed #cbd5e1; padding-top: 15px; }
        .footer-logo { display: block; margin: 0 auto 5px auto; max-height: 28px; width: auto; opacity: 0.85; }
        .footer a { color: var(--primary); text-decoration: none; font-weight: 700; }
        .owner-login-trigger { font-size: 11px; color: #ccc; cursor: pointer; text-decoration: none; position: absolute; bottom: 5px; right: 10px; }

        /* CUSTOMER VIEW */
        .customer-card { text-align: center; padding: 20px; }
        .customer-card h2 { color: var(--primary-dark); }
    </style>
</head>
<body>

<div id="lockScreen" style="display: none;">
    <div class="lock-icon">üîí</div>
    <div class="lock-title">Service Suspended</div>
    <div class="lock-msg">
        This tool has been disabled.<br>Please contact the administrator.
    </div>
    <a href="tel:+917020370561" class="contact-admin-btn">üìû Contact Support</a>
</div>

<div class="container" id="mainApp">

    <div id="customerLinkView" class="hidden customer-card">
        <div style="font-size: 40px; margin-bottom: 10px;">üëÅÔ∏è</div>
        <h2>Hello!</h2>
        <p style="color:#555; font-size:14px; margin-bottom:20px;">
            Here is the review for your visit to Vikash Memorial Eye Hospital.
            <br>Click below to copy & post.
        </p>
        <textarea id="customerReviewText" class="review-preview-box" readonly style="display:block;"></textarea>
        <button class="copy-btn" style="display:block; margin-top:15px;" onclick="copyCustomerLinkReview()">üìã Copy & Open Google</button>
        <p style="font-size:11px; color:#999; margin-top:20px;">Wishing you excellent health! ‚ù§Ô∏è</p>
    </div>

    <div id="generatorApp">
        <h1>Vikash Memorial Eye Hospital</h1>
        <div class="location">üëÅÔ∏è Chaksu ‚Ä¢ Rajasthan</div>
        <div><a href="tel:+919001664477" class="phone-link">üìû Call Hospital</a></div>

        <div id="ratingScreen" class="fade-in">
            <p>How was your eye check-up experience?</p>
            <div class="star-container">
                <span class="star" onclick="rate(1)">‚òÖ</span>
                <span class="star" onclick="rate(2)">‚òÖ</span>
                <span class="star" onclick="rate(3)">‚òÖ</span>
                <span class="star" onclick="rate(4)">‚òÖ</span>
                <span class="star" onclick="rate(5)">‚òÖ</span>
            </div>
            <div class="experience-btns">
                <button class="exp-btn" id="btn-bad" onclick="selectExp('bad')">Needs Improvement üòü</button>
                <button class="exp-btn" id="btn-good" onclick="selectExp('good')">Great Service üëì</button>
            </div>
            <button class="action-btn" onclick="processRating()">Next Step ‚û°</button>
        </div>

        <div id="privateFeedbackScreen" class="fade-in hidden">
            <h2 style="color:var(--text-main);">We are sorry! üòî</h2>
            <p>Please tell us how we can improve your patient experience.</p>
            <textarea id="privateFeedbackText" class="feedback-box" placeholder="Describe the issue..."></textarea>
            <button class="action-btn" style="background:var(--gray);" onclick="submitPrivateFeedback()">Submit Feedback</button>
        </div>

        <div id="thankYouScreen" class="fade-in hidden">
            <div style="font-size: 50px; margin-bottom:10px;">‚úÖ</div>
            <h2 style="color:var(--text-main);">Thank You!</h2>
            <p>Your feedback has been submitted successfully.</p>
        </div>

        <div id="aiToolScreen" class="fade-in hidden" style="text-align: left;">
            
            <div class="input-mode-tabs">
                <button class="mode-btn active-mode" id="btnModeVoice" onclick="switchMode('voice')">üé§ Speak</button>
                <button class="mode-btn" id="btnModeText" onclick="switchMode('text')">‚úçÔ∏è Write</button>
            </div>

            <div id="voiceSection" class="voice-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span style="font-size:11px; font-weight:bold; color:var(--primary-dark);">SPEAK (Hindi/English):</span>
                    <select id="voiceLang" style="width:auto; padding:2px; font-size:11px; height:25px; margin:0;">
                        <option value="hi-IN">Hindi</option>
                        <option value="en-IN">English</option>
                    </select>
                </div>
                <div class="voice-controls">
                    <button id="micBtn" class="mic-btn" onclick="startListening()">üé§</button>
                    <div style="flex:1;">
                        <p id="statusText" style="font-size:12px; color:var(--gray); margin:0;">
                            Mic dabayein aur bolein...<br>
                            (Jaise: "Checkup bahut accha hua")
                        </p>
                    </div>
                </div>
                <div id="spokenTextDisplay" style="display:none; margin-top:10px; font-size:12px; font-style:italic; color:var(--primary-dark); background:#fff; padding:8px; border-radius:4px; border-left: 3px solid var(--primary);"></div>
            </div>

            <div id="textSection" class="text-section hidden">
                <label style="margin-top:0; color:var(--primary-dark);">Describe Experience</label>
                <textarea id="manualInput" placeholder="Ex: Great doctor and clean hospital..." style="height:80px; margin-bottom:0;"></textarea>
            </div>

            <div class="or-divider">OR SELECT MANUALLY</div>

            <div style="display: flex; gap: 10px;">
                <div style="flex:1;">
                    <label style="margin-top:0;">Location</label>
                    <select id="locationSelect">
                        <option value="Chaksu">Chaksu</option>
                        <option value="Rajasthan">Rajasthan</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <label style="margin-top:0;">Language</label>
                    <select id="langSelect">
                        <option value="en">English</option>
                        <option value="hi">Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)</option>
                    </select>
                </div>
            </div>

            <label>Treatment / Check-up</label>
            <select id="procedureSelect">
                <option value="">-- General Checkup --</option>
                <option value="Cataract Surgery">Cataract Surgery (Motiyabind)</option>
                <option value="LASIK">LASIK</option>
                <option value="Glaucoma Surgery">Glaucoma Surgery</option>
            </select>

            <div><button class="toggle-name" onclick="toggleNameField()">+ Add Your Name</button></div>
            <div id="nameArea" style="display:none; clear:both; margin-top:5px;">
                <input type="text" id="userName" placeholder="Your Name (Optional)">
            </div>

            <label style="clear:both;">Select what you liked (Pick 4-5)</label>
            
            <div class="keywords-container">
                <div class="cat-title">Doctor & Staff</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Best Eye Doctor')">üë®‚Äç‚öïÔ∏è Best Eye Doctor</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Experienced Doctor')">üéì Experienced Doctor</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Professional Staff')">ü§ù Professional Staff</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Friendly Nature')">üòä Friendly Nature</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Good Listener')">üëÇ Good Listener</div>

                <div class="cat-title">Facilities & Service</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Best Eye Hospital')">üè• Best Eye Hospital</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Clean & Hygienic')">‚ú® Clean & Hygienic</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Fast Service')">‚è±Ô∏è Fast Service</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Good Management')">üìã Good Management</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Medical Store Inside')">üíä Pharmacy Inside</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Optical Shop')">üëì Optical Shop</div>

                <div class="cat-title">Treatment & Cost</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Successful Treatment')">‚úÖ Successful Treatment</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Painless Surgery')">üòå Painless Surgery</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Affordable Fees')">üí∞ Affordable Fees</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Latest Machines')">‚öôÔ∏è Latest Machines</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Ayushman Card')">üè• Ayushman Card</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Laser Treatment')">‚ö° Laser Treatment</div>

                <div class="cat-title">Overall</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Best in Chaksu')">üìç Best in Chaksu</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Highly Recommended')">üëç Highly Recommended</div>
                <div class="keyword-chip" onclick="toggleKeyword(this, 'Old & Trusted')">üèõÔ∏è Old & Trusted</div>
            </div>

            <button class="action-btn" id="generateBtn" onclick="generateReview()">üöÄ Generate Magic Review</button>

            <textarea id="reviewOutput" class="review-preview-box" readonly></textarea>
            
            <button class="copy-btn" id="copyBtn" onclick="copyToClipboard()">üìã Copy & Open Google</button>

            <div id="ownerPanel">
                <label style="color:var(--whatsapp); margin-top:0;">üì± Patient's WhatsApp Number</label>
                <div style="display:flex; gap:10px;">
                    <input type="tel" id="customerPhone" placeholder="Ex: 9876543210" style="margin-bottom:0;">
                    <button class="whatsapp-send-btn" style="width: auto; padding: 0 20px;" onclick="sendLinkToCustomer()">üöÄ Send</button>
                </div>
                <p style="font-size:11px; color:#555; margin-top:5px;">Patient will receive a direct link to post this review.</p>
            </div>

        </div>
    </div>

    <div class="footer">
        <img src="https://growft.odoo.com/web/image/1477-e0a28764/growft%20logo.webp" class="footer-logo" alt="Growft" loading="lazy">
        <div class="footer-text">
            Powered by <a href="https://growft.net" target="_blank">Growft</a><br>
            Contact to build your AI Tool: <a href="tel:+917020370561">7020370561</a>
        </div>
        <span class="owner-login-trigger" onclick="ownerLogin()">üîí Owner</span>
    </div>
</div>

<script>
    // --- üîê SECURITY & CONFIGURATION ---
    const GOOGLE_REVIEW_LINK = "https://g.page/r/CbzNMBe581gSEBM/review"; 
    
    // CHANGE TO "suspended" TO LOCK THE TOOL
    const APP_STATUS = "suspended"; 
    
    // EXPIRY DATE (YYYY-MM-DD)
    const EXPIRY_DATE = "2026-12-31"; 

    // --- INITIALIZATION ---
    let isOwnerMode = false;

    window.onload = function() {
        // Security Check
        const today = new Date().toISOString().split('T')[0];
        if(APP_STATUS === "suspended" || today > EXPIRY_DATE) {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('lockScreen').style.display = 'flex';
            return;
        }

        // URL Check (Customer Mode)
        const urlParams = newSearchParams(window.location.search);
        const reviewText = urlParams.get('review');
        if (reviewText) {
            document.getElementById('generatorApp').style.display = 'none';
            document.getElementById('customerLinkView').classList.remove('hidden');
            document.getElementById('customerReviewText').value = decodeURIComponent(reviewText);
        } else if(sessionStorage.getItem('isOwner') === 'true') {
            isOwnerMode = true;
        }
    };

    // --- OWNER & WHATSAPP LOGIC ---
    function ownerLogin() {
        if(isOwnerMode) { alert("Already logged in as Owner."); return; }
        const password = prompt("Enter Owner Password:");
        if(password === "admin123") { // CHANGE PASSWORD HERE
            isOwnerMode = true;
            sessionStorage.setItem('isOwner', 'true');
            alert("Owner Mode Active!");
        } else if(password) { alert("Incorrect Password"); }
    }

    function sendLinkToCustomer() {
        const phone = document.getElementById('customerPhone').value.replace(/\D/g, '');
        const review = document.getElementById('reviewOutput').value;
        if(phone.length < 10) { alert("Enter valid number"); return; }
        const finalPhone = phone.length === 10 ? "91" + phone : phone;
        const baseUrl = window.location.href.split('?')[0];
        const magicLink = `${baseUrl}?review=${encodeURIComponent(review)}`;
        const msg = `Namaste! üôè\n\nHere is the review for your visit to Vikash Memorial Eye Hospital:\n\n*Tap this link to Post:*\n${magicLink}`;
        window.open(`https://wa.me/${finalPhone}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function copyCustomerLinkReview() {
        const box = document.getElementById("customerReviewText");
        box.select();
        document.execCommand('copy');
        window.open(GOOGLE_REVIEW_LINK, '_blank');
    }

    // --- APP LOGIC ---
    let selectedKeywords = [];
    let voiceText = "";
    let activeMode = 'voice';

    function switchMode(mode) {
        activeMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active-mode'));
        if(mode === 'voice') {
            document.getElementById('btnModeVoice').classList.add('active-mode');
            document.getElementById('voiceSection').classList.remove('hidden');
            document.getElementById('textSection').classList.add('hidden');
        } else {
            document.getElementById('btnModeText').classList.add('active-mode');
            document.getElementById('textSection').classList.remove('hidden');
            document.getElementById('voiceSection').classList.add('hidden');
        }
    }

    let currentRating = 0;
    let currentExp = '';
    function rate(stars) {
        currentRating = stars;
        document.querySelectorAll('.star').forEach((star, index) => {
            star.classList.toggle('selected', index < stars);
        });
        if(stars >= 4) selectExp('good'); else selectExp('bad');
    }
    
    function selectExp(type) {
        currentExp = type;
        document.getElementById('btn-good').classList.remove('active');
        document.getElementById('btn-bad').classList.remove('bad-active');
        if (type === 'good') document.getElementById('btn-good').classList.add('active');
        else document.getElementById('btn-bad').classList.add('bad-active');
    }

    function processRating() {
        if (currentRating === 0 && currentExp === '') { alert("Please select a star rating."); return; }
        document.getElementById('ratingScreen').classList.add('hidden');
        let isHappy = (currentRating >= 4) || (currentExp === 'good');
        if (isHappy) document.getElementById('aiToolScreen').classList.remove('hidden');
        else document.getElementById('privateFeedbackScreen').classList.remove('hidden');
    }

    function submitPrivateFeedback() {
        if(document.getElementById('privateFeedbackText').value.trim() === "") { alert("Please write a few words."); return; }
        document.getElementById('privateFeedbackScreen').classList.add('hidden');
        document.getElementById('thankYouScreen').classList.remove('hidden');
    }

    function startListening() {
        if (!('webkitSpeechRecognition' in window)) { alert("Use Chrome Browser."); return; }
        recognition = new webkitSpeechRecognition();
        recognition.lang = document.getElementById('voiceLang').value;
        recognition.interimResults = false;
        document.getElementById('micBtn').classList.add('mic-active');
        document.getElementById('statusText').innerText = "Listening...";
        recognition.onresult = (event) => {
            voiceText = event.results[0][0].transcript;
            document.getElementById('spokenTextDisplay').style.display = 'block';
            document.getElementById('spokenTextDisplay').innerText = `Recorded: "${voiceText}"`;
        };
        recognition.onend = () => { document.getElementById('micBtn').classList.remove('mic-active'); document.getElementById('statusText').innerText = "Processing..."; };
        recognition.start();
    }

    // --- PRESERVED DATASETS ---
    const introsEn = [
        "I recently visited Vikash Memorial Eye Hospital in {loc}.",
        "My experience at Vikash Memorial Eye Hospital ({loc}) was excellent.",
        "I went to Vikash Memorial Eye Hospital in {loc} for an eye checkup.",
        "Just got my eyes checked at Vikash Memorial Eye Hospital, {loc}.",
        "Highly satisfied with my visit to Vikash Memorial Eye Hospital in {loc}.",
        "Vikash Memorial Eye Hospital in {loc} is a great place for eye care.",
        "I visited Vikash Memorial Eye Hospital, {loc} a few days ago.",
        "Had a very smooth experience at Vikash Memorial Eye Hospital, {loc}.",
        "I chose Vikash Memorial Eye Hospital in {loc} for my treatment.",
        "Visiting Vikash Memorial Eye Hospital in {loc} was a good decision.",
        "I am writing this review after visiting Vikash Memorial Eye Hospital, {loc}.",
        "My appointment at Vikash Memorial Eye Hospital ({loc}) went very well.",
        "I want to share my experience at Vikash Memorial Eye Hospital, {loc}.",
        "Great service provided by Vikash Memorial Eye Hospital in {loc}.",
        "Consulted the doctors at Vikash Memorial Eye Hospital, {loc}.",
        "The best eye clinic in {loc} is Vikash Memorial Eye Hospital.",
        "I had a wonderful experience at Vikash Memorial Eye Hospital in {loc}.",
        "Went for a routine checkup at Vikash Memorial Eye Hospital, {loc}.",
        "Very professional environment at Vikash Memorial Eye Hospital, {loc}.",
        "Recommending Vikash Memorial Eye Hospital in {loc} after my visit."
    ];

    const introsHi = [
        "‡§Æ‡•à‡§Ç ‡§π‡§æ‡§≤ ‡§π‡•Ä ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§ó‡§Ø‡§æ ‡§•‡§æ‡•§",
        "{loc} ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤ ‡§Æ‡•á‡§Ç ‡§Æ‡•á‡§∞‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§∞‡§π‡§æ‡•§",
        "‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§Æ‡•á‡§Ç ‡§ï‡§∞‡§µ‡§æ‡§à‡•§",
        "‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§ï‡•Ä ‡§∏‡•á‡§µ‡§æ‡§è‡§Å ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§π‡•à‡§Ç‡•§",
        "‡§Æ‡•à‡§Ç ‡§á‡§≤‡§æ‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§ó‡§Ø‡§æ ‡§•‡§æ‡•§",
        "{loc} ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡§æ ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§π‡•à‡•§",
        "‡§Æ‡•Å‡§ù‡•á ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§ï‡§∞ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§≤‡§ó‡§æ‡•§",
        "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•à‡§Ç ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§ó‡§Ø‡§æ ‡§•‡§æ‡•§",
        "‡§Æ‡•á‡§∞‡§æ ‡§ö‡•á‡§ï‡§Ö‡§™ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•á ‡§∏‡•á ‡§π‡•Å‡§Ü‡•§",
        "‡§Æ‡•à‡§Ç {loc} ‡§∏‡•ç‡§•‡§ø‡§§ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤ ‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§",
        "‡§π‡§æ‡§≤ ‡§π‡•Ä ‡§Æ‡•á‡§Ç ‡§Æ‡•à‡§Ç‡§®‡•á ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§ï‡§æ ‡§¶‡•å‡§∞‡§æ ‡§ï‡§ø‡§Ø‡§æ‡•§",
        "‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§Æ‡•á‡§Ç ‡§Æ‡•á‡§∞‡•Ä ‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§∞‡§π‡•Ä‡•§",
        "‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡•á ‡§á‡§≤‡§æ‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è {loc} ‡§Æ‡•á‡§Ç ‡§Ø‡§π ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§ú‡§ó‡§π ‡§π‡•à‡•§",
        "‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§ü‡§æ‡§´ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§π‡•à‡•§",
        "‡§Æ‡•à‡§Ç ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§ï‡•Ä ‡§∏‡•á‡§µ‡§æ‡§ì‡§Ç ‡§∏‡•á ‡§ñ‡•Å‡§∂ ‡§π‡•Ç‡§Å‡•§",
        "‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§Æ‡•á‡§Ç ‡§Æ‡•á‡§∞‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§∂‡§æ‡§®‡§¶‡§æ‡§∞ ‡§•‡§æ‡•§",
        "‡§Æ‡•à‡§Ç‡§®‡•á {loc} ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤ ‡§Æ‡•á‡§Ç ‡§á‡§≤‡§æ‡§ú ‡§ï‡§∞‡§æ‡§Ø‡§æ‡•§",
        "‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§Æ‡•á‡§Ç ‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§¨‡§π‡•Å‡§§ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§•‡§æ‡•§",
        "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§ó‡§Ø‡§æ‡•§",
        "‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§Ü‡§à ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤, {loc} ‡§è‡§ï ‡§≠‡§∞‡•ã‡§∏‡•á‡§Æ‡§Ç‡§¶ ‡§ú‡§ó‡§π ‡§π‡•à‡•§"
    ];

    const outrosEn = [
        "Highly recommended!", "Thank you to the entire team.", "Best eye hospital in the area.",
        "5 stars for the service.", "I will definitely recommend this to my friends.",
        "A big thumbs up!", "Keep up the good work.", "Truly the best eye care center.",
        "Very happy with the results.", "Must visit for any eye problems.",
        "Thank you for the great care.", "Appreciate the doctor's support.",
        "Great value for money.", "I am fully satisfied.", "Excellent patient care.",
        "God bless the team.", "10/10 experience.", "Don't hesitate to visit.",
        "Thanks for restoring my vision.", "Simply the best."
    ];

    const outrosHi = [
        "‡§¨‡§π‡•Å‡§§ ‡§¨‡§π‡•Å‡§§ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!", "‡§Æ‡•à‡§Ç ‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§®‡•á ‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§¶‡•Ç‡§Ç‡§ó‡§æ‡•§", "{loc} ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤‡•§",
        "‡§Æ‡•á‡§∞‡•Ä ‡§§‡§∞‡§´ ‡§∏‡•á 5 ‡§∏‡•ç‡§ü‡§æ‡§∞‡•§", "‡§∏‡•á‡§µ‡§æ ‡§¨‡§π‡•Å‡§§ ‡§π‡•Ä ‡§¨‡•á‡§π‡§§‡§∞‡•Ä‡§® ‡§•‡•Ä‡•§", "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§î‡§∞ ‡§∏‡•ç‡§ü‡§æ‡§´ ‡§ï‡•ã ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§",
        "‡§ú‡§∞‡•Ç‡§∞ ‡§Ü‡§è‡§Ç ‡§Ö‡§ó‡§∞ ‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡•Ä ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§ ‡§π‡•ã‡•§", "‡§Æ‡•à‡§Ç ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§∏‡§Ç‡§§‡•Å‡§∑‡•ç‡§ü ‡§π‡•Ç‡§Å‡•§", "‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§ï‡§æ‡§Æ ‡§ï‡§ø‡§Ø‡§æ‡•§",
        "‡§™‡•à‡§∏‡•á ‡§µ‡§∏‡•Ç‡§≤ ‡§á‡§≤‡§æ‡§ú‡•§", "‡§á‡§≤‡§æ‡§ú ‡§∏‡•á ‡§¨‡§π‡•Å‡§§ ‡§Ü‡§∞‡§æ‡§Æ ‡§Æ‡§ø‡§≤‡§æ‡•§", "‡§≠‡§ó‡§µ‡§æ‡§® ‡§Ü‡§™‡§ï‡§æ ‡§≠‡§≤‡§æ ‡§ï‡§∞‡•á‡•§",
        "‡§∂‡§æ‡§®‡§¶‡§æ‡§∞ ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§∞‡§π‡§æ‡•§", "‡§Ø‡§π‡§æ‡§Å ‡§ï‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§π‡•à‡•§", "‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡§ø‡§Ø‡§≤ ‡§ü‡•Ä‡§Æ‡•§",
        "‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§®‡•á‡§§‡•ç‡§∞ ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ‡§≤‡§Ø‡•§", "‡§Æ‡•à‡§Ç ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§Ü‡§ä‡§Ç‡§ó‡§æ‡•§", "‡§¨‡•á‡§ù‡§ø‡§ù‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§è‡§Ç‡•§",
        "‡§¨‡§π‡•Å‡§§ ‡§π‡•Ä ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤‡•§", "‡§∏‡§¨‡§ï‡•ã ‡§Ø‡§π‡•Ä ‡§Ü‡§®‡•á ‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§π‡•à‡•§"
    ];

    const keywordData = {
        "Best Eye Doctor": { en: "The doctor is very experienced and skilled.", hi: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§®‡•Å‡§≠‡§µ‡•Ä ‡§î‡§∞ ‡§ï‡•Å‡§∂‡§≤ ‡§π‡•à‡§Ç‡•§" },
        "Experienced Doctor": { en: "Dr. has great experience and diagnosis is perfect.", hi: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡§æ‡§π‡§¨ ‡§ï‡•ã ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§π‡•à ‡§î‡§∞ ‡§®‡§ø‡§¶‡§æ‡§® ‡§∏‡§π‡•Ä ‡§π‡•à‡•§" },
        "Professional Staff": { en: "The staff is professional and supportive.", hi: "‡§∏‡•ç‡§ü‡§æ‡§´ ‡§¨‡§π‡•Å‡§§ ‡§™‡•á‡§∂‡•á‡§µ‡§∞ ‡§î‡§∞ ‡§∏‡§π‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•à‡•§" },
        "Friendly Nature": { en: "Doctors have a very friendly nature.", hi: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¨‡§π‡•Å‡§§ ‡§Æ‡§ø‡§≤‡§®‡§∏‡§æ‡§∞ ‡§π‡•à‡•§" },
        "Good Listener": { en: "The doctor listens to problems patiently.", hi: "‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§ß‡•à‡§∞‡•ç‡§Ø‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡•Å‡§®‡§§‡•á ‡§π‡•à‡§Ç‡•§" },
        "Best Eye Hospital": { en: "It is the best eye hospital in {loc}.", hi: "‡§Ø‡§π {loc} ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡§æ ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§π‡•à‡•§" },
        "Clean & Hygienic": { en: "The hospital is very clean and hygienic.", hi: "‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§´ ‡§î‡§∞ ‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ ‡§π‡•à‡•§" },
        "Fast Service": { en: "Service was fast, no long waiting time.", hi: "‡§∏‡•á‡§µ‡§æ ‡§§‡•á‡§ú ‡§•‡•Ä, ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§á‡§Ç‡§§‡§ú‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§®‡§æ ‡§™‡§°‡§º‡§æ‡•§" },
        "Good Management": { en: "Everything is well managed here.", hi: "‡§Ø‡§π‡§æ‡§Å ‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§π‡•à‡•§" },
        "Medical Store Inside": { en: "Pharmacy is available inside the hospital.", hi: "‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§π‡•Ä ‡§Æ‡•á‡§°‡§ø‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡•§" },
        "Optical Shop": { en: "They have a good optical shop for glasses.", hi: "‡§ö‡§∂‡•ç‡§Æ‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§®‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§¶‡•Å‡§ï‡§æ‡§® ‡§π‡•à‡•§" },
        "Successful Treatment": { en: "My treatment was 100% successful.", hi: "‡§Æ‡•á‡§∞‡§æ ‡§á‡§≤‡§æ‡§ú 100% ‡§∏‡§´‡§≤ ‡§∞‡§π‡§æ‡•§" },
        "Painless Surgery": { en: "The surgery was completely painless.", hi: "‡§∏‡§∞‡•ç‡§ú‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§¶‡§∞‡•ç‡§¶ ‡§∞‡§π‡§ø‡§§ ‡§•‡•Ä‡•§" },
        "Affordable Fees": { en: "Treatment charges are very affordable.", hi: "‡§á‡§≤‡§æ‡§ú ‡§ï‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§¨‡§π‡•Å‡§§ ‡§ï‡§Æ ‡§î‡§∞ ‡§µ‡§æ‡§ú‡§ø‡§¨ ‡§π‡•à‡•§" },
        "Latest Machines": { en: "Hospital is equipped with latest machines.", hi: "‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§Æ‡§∂‡•Ä‡§®‡•ã‡§Ç ‡§∏‡•á ‡§∏‡•Å‡§∏‡§ú‡•ç‡§ú‡§ø‡§§ ‡§π‡•à‡•§" },
        "Ayushman Card": { en: "Ayushman card facility is available.", hi: "‡§Ü‡§Ø‡•Å‡§∑‡•ç‡§Æ‡§æ‡§® ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡•Ä ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡•§" },
        "Laser Treatment": { en: "Advanced laser treatment is available.", hi: "‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§≤‡•á‡§ú‡§∞ ‡§â‡§™‡§ö‡§æ‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡•§" },
        "Best in Chaksu": { en: "Definately the best hospital in Chaksu.", hi: "‡§ö‡§æ‡§ï‡§∏‡•Ç ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤‡•§" },
        "Highly Recommended": { en: "I highly recommend everyone to visit here.", hi: "‡§Æ‡•à‡§Ç ‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§®‡•á ‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§" },
        "Old & Trusted": { en: "It is an old and trusted eye care center.", hi: "‡§Ø‡§π ‡§è‡§ï ‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§î‡§∞ ‡§≠‡§∞‡•ã‡§∏‡•á‡§Æ‡§Ç‡§¶ ‡§®‡•á‡§§‡•ç‡§∞ ‡§¶‡•á‡§ñ‡§≠‡§æ‡§≤ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§π‡•à‡•§" }
    };

    async function generateReview() {
        const btn = document.getElementById('generateBtn');
        const originalText = btn.innerText;
        btn.innerText = "üîÑ Processing...";
        
        const lang = document.getElementById('langSelect').value;
        const location = document.getElementById('locationSelect').value;
        const userName = document.getElementById('userName').value.trim();
        const procedure = document.getElementById('procedureSelect').value;
        const manualText = document.getElementById('manualInput').value.trim();
        let rawInput = activeMode === 'voice' ? voiceText : manualText;

        if (selectedKeywords.length === 0 && !rawInput && !procedure) {
            alert("Please select highlights or say something.");
            btn.innerText = originalText;
            return;
        }

        const isHindi = (lang === 'hi' || lang === 'hinglish');

        // Translation
        let finalBodyText = "";
        if (rawInput && rawInput.length > 1) {
            try {
                if(!isHindi) {
                    const srcLangCode = document.getElementById('voiceLang').value.split('-')[0];
                    let langPair = srcLangCode === 'hi' ? 'hi|en' : 'Autodetect|en';
                    const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(rawInput)}&langpair=${langPair}`);
                    const data = await res.json();
                    let translated = data.responseData ? data.responseData.translatedText : "";
                    if(!translated.includes("PLEASE SELECT")) finalBodyText = translated;
                    else finalBodyText = rawInput;
                } else {
                    finalBodyText = rawInput;
                }
            } catch(e) { finalBodyText = rawInput; }
        }

        // Assembly
        let introTemplate = isHindi ? getRandomItem(introsHi) : getRandomItem(introsEn);
        let review = introTemplate.replace(/{loc}/g, location) + " ";

        if (userName) {
            review = (isHindi ? `‡§Æ‡•à‡§Ç ${userName} ‡§π‡•Ç‡§Å‡•§ ` : `I am ${userName}. `) + review;
        }

        if (procedure) {
            review += (isHindi ? `‡§Æ‡•à‡§Ç‡§®‡•á ${procedure} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§µ‡§ø‡•õ‡§ø‡§ü ‡§ï‡§ø‡§Ø‡§æ‡•§ ` : `I visited for ${procedure}. `);
        }

        const shuffledKeywords = selectedKeywords.sort(() => Math.random() - 0.5);
        shuffledKeywords.forEach(key => {
            if(keywordData[key]) {
                let sentence = isHindi ? keywordData[key].hi : keywordData[key].en;
                sentence = sentence.replace(/{loc}/g, location);
                review += sentence + " ";
            }
        });

        if (finalBodyText) review += finalBodyText + " ";

        let outroTemplate = isHindi ? getRandomItem(outrosHi) : getRandomItem(outrosEn);
        review += outroTemplate.replace(/{loc}/g, location);

        const outputBox = document.getElementById('reviewOutput');
        const copyBtn = document.getElementById('copyBtn');
        
        setTimeout(() => {
            outputBox.style.display = 'block';
            outputBox.style.opacity = "1";
            outputBox.value = review;
            btn.innerText = originalText;
            
            if(isOwnerMode) {
                document.getElementById('ownerPanel').style.display = 'block';
                document.getElementById('copyBtn').style.display = 'none';
            } else {
                document.getElementById('ownerPanel').style.display = 'none';
                document.getElementById('copyBtn').style.display = 'block';
            }

            if (window.innerWidth < 600) outputBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 500);
    }

    function toggleNameField() { 
        const field = document.getElementById('nameArea');
        field.style.display = field.style.display === 'block' ? 'none' : 'block';
    }

    function toggleKeyword(element, keyword) {
        element.classList.toggle('active');
        if (selectedKeywords.includes(keyword)) selectedKeywords = selectedKeywords.filter(item => item !== keyword);
        else selectedKeywords.push(keyword);
    }
    
    function copyToClipboard() {
        const copyText = document.getElementById("reviewOutput");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(() => {
            const isConfirmed = confirm("Review Copied! üëÅÔ∏è\n\nClick OK to open Google Maps.");
            if(isConfirmed) window.open(GOOGLE_REVIEW_LINK, '_blank');
        });
    }
    
    function getRandomItem(arr) { if(!arr) return ""; return arr[Math.floor(Math.random() * arr.length)]; }
</script>

</body>
</html>
