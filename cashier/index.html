<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Cashier Panel - Hotel Vijay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>@media print { .no-print { display: none !important; } body { background: white; color: black; } }</style>
</head>
<body class="bg-slate-900 text-white p-6">
    <div class="max-w-6xl mx-auto flex justify-between items-center mb-8 border-b border-slate-700 pb-6">
        <h1 class="text-4xl font-black text-orange-500 italic">Hotel Vijay</h1>
        <div id="st" class="text-green-400 font-bold text-xs animate-pulse">● LIVE (Click for sound)</div>
    </div>
    <div id="container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwQUMyN5rBmSztswmu16HBnvz27XhVnTt1aOdpEoFITeEiH22BM_ocNKb5Ub1_2EGZH/exec";
        let lastCount = 0;
        const sound = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');

        async function load(isUpdate = false) {
            try {
                const r = await fetch(SCRIPT_URL + "?t=" + new Date().getTime());
                const data = await r.json();
                const valid = data.filter(o => o.invoice_no && o.customer_name);
                if(!isUpdate && valid.length > lastCount && lastCount !== 0) sound.play().catch(e => {});
                lastCount = valid.length;
                render(valid.reverse());
            } catch (e) { console.log(e); }
        }

        function render(orders) {
            const container = document.getElementById('container');
            container.innerHTML = '';
            orders.forEach(order => {
                container.innerHTML += `<div class="bg-slate-800 p-6 rounded-3xl border border-slate-700">
                    <p class="text-[10px] text-orange-500 font-bold uppercase">Inv: #${order.invoice_no}</p>
                    <h3 class="text-xl font-black uppercase">${order.customer_name}</h3>
                    <p class="text-xs font-bold text-slate-400 mb-4 tracking-tighter uppercase">Table: ${order.table_no} | Status: ${order.status}</p>
                    <div class="bg-slate-900/50 p-4 rounded-2xl mb-4 border border-slate-700/50 text-sm font-bold">${order.items}</div>
                    <div class="flex gap-2 no-print">
                        <button onclick="updateStatus('${order.invoice_no}', 'Preparing')" class="flex-1 bg-blue-600 py-3 rounded-xl font-bold text-xs">PREPARING</button>
                        <button onclick="updateStatus('${order.invoice_no}', 'Ready')" class="flex-1 bg-green-600 py-3 rounded-xl font-bold text-xs">READY</button>
                    </div>
                </div>`;
            });
        }

        async function updateStatus(inv, s) {
            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: "update", invoice_no: inv, new_status: s }) });
            load(true);
        }

        setInterval(() => load(false), 10000); load();
        document.body.addEventListener('click', () => { sound.play().then(() => sound.pause()); document.getElementById('st').innerText = "● LIVE (Audio ON)"; }, {once: true});
    </script>
</body>
</html>
