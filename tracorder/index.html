<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Tracking - Hotel Vijay</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-6">
    <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl p-8 text-center border border-gray-100">
        <div id="loader" class="text-6xl mb-4 transition-all duration-500">ğŸ‘¨â€ğŸ³</div>
        
        <h2 class="text-gray-400 font-bold uppercase text-[10px] tracking-widest mb-1">Order Tracking</h2>
        <h1 id="inv-display" class="text-2xl font-black text-slate-800 tracking-tighter">#CHECKING...</h1>
        
        <div id="status-badge" class="mt-6 inline-block px-10 py-4 rounded-full font-black text-lg bg-orange-100 text-orange-600 animate-pulse uppercase">
            CONNECTING...
        </div>

        <div class="mt-6">
            <button id="ask-btn" onclick="askCashier()" class="text-[10px] font-black border-2 border-slate-200 px-6 py-2 rounded-xl text-slate-400 hover:border-orange-500 hover:text-orange-500 transition-all uppercase tracking-widest active:scale-95">
                Ask Status / Status Puchhein
            </button>
            <p id="query-msg" class="text-[9px] text-gray-400 mt-2 hidden">Request sent to cashier...</p>
        </div>

        <p id="status-msg" class="mt-8 text-gray-500 text-sm italic leading-relaxed px-4">
            Bhai, Chef ne aapka order dekh liya hai. Khana jaldi hi aapke table par hoga!
        </p>

        <div class="mt-10 space-y-3">
            <button onclick="location.href='https://www.growft.online/hotelvijay/'" class="w-full py-4 rounded-2xl bg-slate-900 text-white font-bold shadow-lg active:scale-95 transition-all">
                Order More Items
            </button>
            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest pt-4">Growft Digital System</p>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwQUMyN5rBmSztswmu16HBnvz27XhVnTt1aOdpEoFITeEiH22BM_ocNKb5Ub1_2EGZH/exec";
        const params = new URLSearchParams(window.location.search);
        const invID = params.get('id');

        if (!invID) {
            document.getElementById('inv-display').innerText = "Order Not Found";
        } else {
            document.getElementById('inv-display').innerText = "#" + invID;
        }

        // --- NEW: User Request to Cashier Logic ---
        async function askCashier() {
            const btn = document.getElementById('ask-btn');
            const msg = document.getElementById('query-msg');
            
            btn.innerText = "ASKING...";
            btn.disabled = true;

            try {
                // Cashier ko request bhej raha hai
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ 
                        action: "ask_status", 
                        invoice_no: invID 
                    })
                });
                
                btn.innerText = "REQUEST SENT âœ…";
                btn.className = "text-[10px] font-black border-2 border-green-500 px-6 py-2 rounded-xl text-green-500 uppercase tracking-widest";
                msg.classList.remove('hidden');
                
                // 30 second baad button reset karein taaki user firse puch sake
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerText = "Ask Status / Status Puchhein";
                    btn.className = "text-[10px] font-black border-2 border-slate-200 px-6 py-2 rounded-xl text-slate-400 uppercase tracking-widest";
                    msg.classList.add('hidden');
                }, 30000);

            } catch (e) {
                btn.innerText = "TRY AGAIN";
                btn.disabled = false;
            }
        }

        async function checkStatus() {
            if (!invID) return;
            try {
                const res = await fetch(SCRIPT_URL + "?t=" + new Date().getTime());
                const orders = await res.json();
                const myOrder = orders.find(o => String(o.invoice_no).trim() === String(invID).trim());

                if(myOrder) {
                    const badge = document.getElementById('status-badge');
                    const loader = document.getElementById('loader');
                    const statusText = document.getElementById('status-msg');
                    const status = myOrder.status.toLowerCase().trim();
                    
                    badge.innerText = myOrder.status.toUpperCase();
                    
                    if(status === "pending") {
                        badge.className = "mt-6 inline-block px-10 py-4 rounded-full font-black bg-orange-100 text-orange-600 animate-pulse";
                        loader.innerText = "ğŸ‘¨â€ğŸ³";
                    }
                    else if(status === "preparing") { 
                        badge.className = "mt-6 inline-block px-10 py-4 rounded-full font-black bg-blue-100 text-blue-600 animate-bounce"; 
                        loader.innerText = "ğŸ”¥"; 
                        statusText.innerText = "Cashier says: Aapka khana kitchen mein taiyar ho raha hai!";
                    }
                    else if(status === "ready" || status === "served") { 
                        badge.className = "mt-6 inline-block px-10 py-4 rounded-full font-black bg-green-500 text-white"; 
                        loader.innerText = "ğŸ˜‹"; 
                        statusText.innerText = "Khana Taiyar hai! Enjoy your meal.";
                    }
                }
            } catch (e) { console.log(e); }
        }

        setInterval(checkStatus, 8000); 
        checkStatus();
    </script>
</body>
</html>
