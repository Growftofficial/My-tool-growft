<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwQUMyN5rBmSztswmu16HBnvz27XhVnTt1aOdpEoFITeEiH22BM_ocNKb5Ub1_2EGZH/exec";
    
    // URL se ID lena
    const params = new URLSearchParams(window.location.search);
    const invID = params.get('id');

    // Agar ID nahi hai toh Home par bhej do ya error dikhao
    if (!invID) {
        document.getElementById('inv-display').innerText = "Order Not Found";
        document.getElementById('status-badge').innerText = "ERROR";
        document.getElementById('status-badge').className = "mt-6 inline-block px-10 py-4 rounded-full font-black bg-red-100 text-red-600";
    } else {
        document.getElementById('inv-display').innerText = "#" + invID;
    }

    async function checkStatus() {
        if (!invID) return; // ID nahi toh check mat karo
        
        try {
            const res = await fetch(SCRIPT_URL + "?t=" + new Date().getTime());
            const orders = await res.json();
            
            // Exact ID wala order dhundna
            const myOrder = orders.find(o => String(o.invoice_no).trim() === String(invID).trim());

            if(myOrder) {
                const badge = document.getElementById('status-badge');
                const loader = document.getElementById('loader');
                const status = myOrder.status.toLowerCase().trim();
                
                badge.innerText = myOrder.status.toUpperCase();
                
                if(status === "preparing") { 
                    badge.className = "mt-6 inline-block px-10 py-4 rounded-full font-black bg-blue-100 text-blue-600 animate-bounce"; 
                    loader.innerText = "ðŸ”¥"; 
                }
                else if(status === "ready" || status === "served") { 
                    badge.className = "mt-6 inline-block px-10 py-4 rounded-full font-black bg-green-500 text-white"; 
                    loader.innerText = "ðŸ˜‹"; 
                    // Served hone par message badalna
                    document.querySelector('p.italic').innerText = "Enjoy your meal! Aapka khana serve ho chuka hai.";
                }
            }
        } catch (e) { console.log("Fetch Error:", e); }
    }

    // Har 8 second mein update
    setInterval(checkStatus, 8000); 
    checkStatus();
</script>
