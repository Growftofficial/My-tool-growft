<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Your Order - Hotel Vijay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .step-line { position: absolute; left: 19px; top: 30px; height: 100%; width: 2px; background: #e2e8f0; z-index: -1; }
        .step-active .step-icon { background: #ea580c; box-shadow: 0 0 15px rgba(234, 88, 12, 0.4); }
        .step-active .step-text { color: #ea580c; font-weight: 900; }
        .pulse-orange { animation: pulse 2s infinite; }
        
        /* üì° Naya Loader Animation CSS */
        .bounce-icon { animation: bounceIcon 1s infinite alternate; }
        @keyframes bounceIcon {
            0% { transform: translateY(0) scale(1.1); }
            100% { transform: translateY(-30px) scale(0.9); }
        }
        .shadow-pulse { animation: shadowPulse 1s infinite alternate; }
        @keyframes shadowPulse {
            0% { transform: scale(1); opacity: 0.5; }
            100% { transform: scale(0.5); opacity: 0.1; }
        }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900 pb-10">

    <div id="tracking-loader" class="fixed inset-0 bg-slate-900 z-[100] flex flex-col items-center justify-center transition-opacity duration-500 text-white">
        <div class="relative w-32 h-32 mb-4 flex flex-col items-center">
            <div class="text-7xl bounce-icon z-10">üì°</div>
            <div class="w-16 h-3 bg-orange-600 rounded-[100%] absolute bottom-0 shadow-pulse blur-sm"></div>
        </div>
        <h2 class="text-2xl font-black italic uppercase tracking-widest mt-4">Locating Order...</h2>
        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-2 animate-pulse">Contacting Kitchen...</p>
    </div>

    <div class="bg-white p-4 shadow-sm flex justify-between items-center sticky top-0 z-50 border-b border-slate-100">
        <div class="flex items-center gap-3">
            <button onclick="goBackToMenu()" class="bg-slate-100 p-2 rounded-xl hover:bg-slate-200 transition-all active:scale-90">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <div>
                <h1 class="text-lg font-black italic text-orange-600 leading-none">HOTEL VIJAY</h1>
                <p class="text-[8px] font-bold text-slate-400 uppercase tracking-widest">Live Order Tracking</p>
            </div>
        </div>
        <div class="bg-slate-100 px-3 py-1.5 rounded-xl text-[10px] font-black tracking-tighter">
            ID: <span id="display-id" class="text-orange-600">#0000</span>
        </div>
    </div>

    <div class="max-w-md mx-auto p-5">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-xl shadow-slate-200/50 mb-6 text-center border border-white">
            <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">Current Status</p>
            <h2 id="current-status-text" class="text-4xl font-black text-slate-800 mb-2 italic uppercase">Checking...</h2>
            <div id="status-desc" class="text-xs text-slate-500 font-bold px-4">Wait kariye, hum kitchen se update le rahe hain...</div>
        </div>

        <div id="rejected-message" class="hidden bg-red-100 border-2 border-red-500 p-6 rounded-3xl mt-6 text-center shadow-lg shadow-red-200">
            <span class="text-4xl mb-2 block">üòî</span>
            <h3 class="text-red-700 font-black text-xl mb-1 uppercase">Order Rejected</h3>
            <p class="text-xs text-red-600 font-bold">Sorry, kitchen abhi bahut busy hai ya item available nahi hai. Kripya counter par sampark karein.</p>
        </div>

        <div id="timeline-container" class="space-y-10 px-4 relative mt-10">
            <div id="step-pending" class="flex items-start gap-6 relative">
                <div class="step-line"></div>
                <div class="step-icon w-10 h-10 rounded-2xl bg-slate-200 flex items-center justify-center text-white shrink-0 transition-all duration-500">
                    <span class="text-lg font-bold">1</span>
                </div>
                <div>
                    <h3 class="step-text text-slate-400 text-lg">Waiting for Approval</h3>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">Cashier order accept kar rahe hain</p>
                </div>
            </div>

            <div id="step-preparing" class="flex items-start gap-6 relative">
                <div class="step-line"></div>
                <div class="step-icon w-10 h-10 rounded-2xl bg-slate-200 flex items-center justify-center text-white shrink-0 transition-all duration-500">
                    <span class="text-lg font-bold">2</span>
                </div>
                <div>
                    <h3 class="step-text text-slate-400 text-lg">Order Accepted & Preparing</h3>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">Chef aapka khana bana rahe hain</p>
                </div>
            </div>

            <div id="step-ready" class="flex items-start gap-6">
                <div class="step-icon w-10 h-10 rounded-2xl bg-slate-200 flex items-center justify-center text-white shrink-0 transition-all duration-500">
                    <span class="text-lg font-bold">3</span>
                </div>
                <div>
                    <h3 class="step-text text-slate-400 text-lg">Ready to Serve</h3>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">Khana table par aa raha hai!</p>
                </div>
            </div>
        </div>

        <div class="mt-12">
            <button onclick="askStatus()" id="askBtn" class="w-full bg-slate-900 text-white py-5 rounded-[2rem] font-black shadow-lg shadow-slate-300 active:scale-95 transition-all flex items-center justify-center gap-3">
                <span class="text-xl">üõéÔ∏è</span> ASK FOR STATUS
            </button>
            
            <button onclick="finishOrder()" id="completeBtn" class="hidden w-full bg-green-600 text-white py-5 rounded-[2rem] font-black shadow-lg shadow-green-300 active:scale-95 transition-all flex items-center justify-center gap-3 animate-bounce">
                <span class="text-xl">üçΩÔ∏è</span> I RECEIVED MY ORDER ‚úÖ
            </button>

            <p id="helper-text" class="text-center text-[10px] text-slate-400 mt-4 font-bold uppercase tracking-widest leading-loose">
                Agar khana aane mein deri ho rahi ho,<br>toh upar wala button dabayein.
            </p>
        </div>
    </div>

    <script>
        // ==========================================
        // YAHAN APNA MASTER SCRIPT URL DALNA HAI
        // ==========================================
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFZXiQ9c1CPbJ6Js0o6HtIt4mEIRigzAI6CxgXKLId5fOy3VCoLBZC_F4DAspf1h4EsA/exec";
        
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('id');
        document.getElementById('display-id').innerText = "#" + (orderId || "0000");

        function goBackToMenu() {
            window.location.href = "https://www.growft.online/hotelvijay/index.html"; 
        }

        // Order Complete Hone Par Memory Clear Karne Ka Function
        function finishOrder() {
            localStorage.removeItem('activeVijayOrder'); 
            alert("Asha hai aapko khana pasand aaya! Thank You.");
            goBackToMenu(); 
        }

        async function checkStatus() {
            if (!orderId) {
                document.getElementById('tracking-loader').innerHTML = '<h2 class="text-2xl font-black text-red-500">Order ID Not Found!</h2>';
                return;
            }
            try {
                const res = await fetch(SCRIPT_URL + "?t=" + new Date().getTime());
                const orders = await res.json();
                const myOrder = orders.find(o => o.invoice_no === orderId);

                if (myOrder) {
                    updateTimeline(myOrder.status);
                }

                // ‚ú® Data aate hi Loading Screen smoothly gayab kar do
                const loader = document.getElementById('tracking-loader');
                if(!loader.classList.contains('hidden')) {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.classList.add('hidden'), 500);
                }

            } catch (e) { 
                console.log("Polling error..."); 
                const loader = document.getElementById('tracking-loader');
                if(!loader.classList.contains('hidden')) {
                    loader.innerHTML = '<h2 class="text-2xl font-black text-red-500">Connection Error!</h2><p class="text-xs text-white">Retrying...</p>';
                }
            }
        }

        function updateTimeline(status) {
            const sText = document.getElementById('current-status-text');
            const sDesc = document.getElementById('status-desc');
            const askBtn = document.getElementById('askBtn');
            const completeBtn = document.getElementById('completeBtn');
            const helperText = document.getElementById('helper-text');
            const timeline = document.getElementById('timeline-container');
            const rejectedMsg = document.getElementById('rejected-message');
            
            document.querySelectorAll('.step-icon').forEach(el => el.parentElement.classList.remove('step-active'));
            
            if (status === "Pending") {
                sText.innerText = "Order Received";
                sDesc.innerText = "Cashier aapka order check kar rahe hain...";
                document.getElementById('step-pending').classList.add('step-active');
            } else if (status === "Preparing") {
                sText.innerText = "Cooking... üç≥";
                sDesc.innerText = "Order accept ho gaya hai! Khana ban raha hai.";
                document.getElementById('step-pending').classList.add('step-active');
                document.getElementById('step-preparing').classList.add('step-active');
            } else if (status === "Ready" || status === "Served") {
                sText.innerText = "READY! üî•";
                sDesc.innerText = "Khana table par hai! Button dabakar confirm karein.";
                document.querySelectorAll('.step-icon').forEach(el => el.parentElement.classList.add('step-active'));
                
                askBtn.classList.add('hidden');
                helperText.classList.add('hidden');
                completeBtn.classList.remove('hidden');

                if(status === "Served") {
                    localStorage.removeItem('activeVijayOrder');
                }
                if(window.navigator.vibrate) window.navigator.vibrate([200, 100, 200]);
            } else if (status === "Rejected") {
                sText.innerText = "REJECTED";
                sDesc.innerText = "Order cancel kar diya gaya hai.";
                
                timeline.classList.add('hidden');
                askBtn.classList.add('hidden');
                helperText.classList.add('hidden');
                rejectedMsg.classList.remove('hidden');
                
                localStorage.removeItem('activeVijayOrder'); 
            }
        }

        async function askStatus() {
            const btn = document.getElementById('askBtn');
            btn.innerText = "PINGING CASHIER...";
            btn.disabled = true;

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors',
                    body: JSON.stringify({ action: "ask_status", invoice_no: orderId })
                });
                alert("Bhai, Cashier ko bol diya hai! Woh turant kitchen mein check karenge.");
            } catch (e) { }
            
            setTimeout(() => {
                btn.innerHTML = `<span class="text-xl">üõéÔ∏è</span> ASK FOR STATUS`;
                btn.disabled = false;
            }, 5000);
        }

        setInterval(checkStatus, 4000);
        checkStatus();
    </script>
</body>
</html>
